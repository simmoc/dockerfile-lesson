
/**
 * 由 Fantastic-admin 提供技术支持
 * https://hooray.gitee.io/fantastic-admin/
 * Powered by Fantastic-admin
 * https://hooray.github.io/fantastic-admin/
 */
    
import{H as x}from"./index.94e839d6.js";import{c as T,a as m}from"./card.fffc3274.js";import w from"./scrollLoader.22d3a377.js";import{_ as S}from"./plugin-vue_export-helper.21dcd24c.js";import{r as _,a,q as o,t as i,y as g,z as k,D as l,A as d,R as v,S as M,J as j,F as C,G as z,H as A}from"./vendor.d2559d84.js";const V={name:"",components:{card:T,ScrollLoader:w},props:{staffInfo:{type:Object,default:()=>({})},activeType:{type:String,default:()=>""},chatInfo:{type:Object,default:()=>({})},selectMember:{type:Object,default:()=>{}}},data(){return{selectDate:"",messageList:[],page:1,pageSize:10,isLoading:!1,isLoadedAll:!1,typeList:m.typeList,pickerOptions:{disabledDate(t){let s=t.getTime(),n=Date.now()-90*24*60*60*1e3;return s>Date.now()||s<n}}}},computed:{messageInfo(){const{chatInfo:t,staffInfo:s}=this;return{chatInfo:t,staffInfo:s}}},watch:{messageInfo:{handler(t){let{chatInfo:s,staffInfo:n}=t;s.id&&n.id?(console.log("watch---messageInfo"),this.getMessageList({type:"init"})):this.initData()},deep:!0}},created(){console.log("msgTypeList",m)},mounted(){this.selectDate=this.selectMember},methods:{changeDate(){this.getMessageList({type:"init"}),console.log("\u65E5\u671F\u6539\u53D8\u4E86",this.selectDate)},refresh(){console.log("\u70B9\u51FB\u4E86\u66F4\u65B0");let{chatInfo:t,staffInfo:s}=this;t.id&&s.department_id&&(this.selectDate=null,this.getMessageList({type:"init"}))},isExecute(){let{chatInfo:t,staffInfo:s}=this,n=t.id,p=s.department_id;if(!n||!p)return!1},getMessageList(t={}){if(console.log("request--->getMessageList"),this.isLoading)return;this.isLoading=!0,this.isExecute();let s=t.type;s=="init"&&this.initData();let{chatInfo:n,selectDate:p,staffInfo:c,page:r,pageSize:f}=this;if(!n.id||!c.department_id)return;let u={date:p||"",type:n.chatType,member_id:c.department_id,object_id:n.id,page:r,pageSize:f};x.getMessageList(u).then(y=>{let{total_page:L,list:e}=y.data;console.log("getMessageList-=============>",e),e=e.reverse(),e.forEach(h=>{let I=m.typeList.find(D=>D.msgtype.indexOf(h.msgtype)>-1)||{},{showType:b}=I;h.showType=b||"text"}),s!="init"?this.messageList=[...e,...this.messageList]:(console.log("\u521D\u59CB\u5316\u6570\u636E",e),this.messageList=e,this.scrollBottom()),this.page=parseInt(this.page)+1,this.isLoading=!1,console.log("this.page-----this.page",this.page),this.page>L&&(this.isLoadedAll=!0),t.callback&&t.callback()}).catch(()=>{this.isLoading=!1})},scrollBottom(){this.$nextTick(()=>{setTimeout(()=>{new m.AnimationScrollPosition({element:"#scrollLoader-container"})},100)})},initData(){this.page=1,this.pageSize=10,this.isLoading=!1,this.isLoadedAll=!1,this.messageList=[]},infinite(){}}},q=t=>(C("data-v-0429dfe5"),t=t(),z(),t),O={class:"record"},B={class:"select-date"},E={class:"left"},N=q(()=>i("span",{class:"title"},"\u65E5\u671F\u7B5B\u9009",-1)),Y={class:"button"},H=A("\u5237\u65B0"),F={class:"record-content"},G={class:"im-chat-main"},J={id:"message-box",class:"im-chat-main-box messages"},P={key:0,class:"im-chat-more"},R={key:1,class:"im-chat-more-txt"},U={key:0,class:"system-msg"},K={key:1,class:"system-msg"},Q={key:2,class:"system-msg"},W={class:"im-chat-user"},X=["src"],Z={key:0,class:"message-info message-info-mine"},$={key:0},ee={key:0},te={key:1,class:"message-info"},se={key:0},ae={key:0},oe={class:"im-chat-text"};function ie(t,s,n,p,c,r){const f=_("el-date-picker"),u=_("el-button"),y=_("card"),L=_("ScrollLoader");return a(),o("div",O,[i("div",B,[i("div",E,[N,g(f,{modelValue:c.selectDate,"onUpdate:modelValue":s[0]||(s[0]=e=>c.selectDate=e),"value-format":"YYYY-MM-DD",type:"date",placeholder:"\u9009\u62E9\u65E5\u671F","picker-options":c.pickerOptions,size:"small",onChange:r.changeDate},null,8,["modelValue","picker-options","onChange"])]),i("div",Y,[g(u,{type:"primary",size:"small",onClick:r.refresh},{default:k(()=>[H]),_:1},8,["onClick"])])]),i("div",F,[i("div",G,[g(L,{onScrollToTop:r.infinite},{default:k(()=>[i("div",J,[i("ul",null,[c.page>1?(a(),o("li",P,[c.isLoadedAll?l("",!0):(a(),o("div",{key:0,class:"im-chat-more-txt",style:{color:"#00c587"},onClick:s[1]||(s[1]=(...e)=>r.getMessageList&&r.getMessageList(...e))}," \u52A0\u8F7D\u66F4\u591A ")),c.isLoadedAll?(a(),o("div",R,d(c.messageList.length==0?"\u6682\u65E0\u6570\u636E":"\u6CA1\u6709\u66F4\u591A\u4E86"),1)):l("",!0)])):l("",!0),(a(!0),o(v,null,M(c.messageList,(e,h)=>(a(),o("li",{key:h,class:j([e.from=="true"&&"im-chat-mine","im-chat-"+e.showType])},[e.showType==="system"?(a(),o(v,{key:0},[e.msgtype=="disagree"?(a(),o("div",U,d(n.activeType==1?"\u5BF9\u65B9":e.name)+"\u4E0D\u540C\u610F\u5B58\u6863\u4F1A\u8BDD\u5185\u5BB9,\u4F60\u5C06\u65E0\u6CD5\u7EE7\u7EED\u63D0\u4F9B\u670D\u52A1 ",1)):l("",!0),e.msgtype=="agree"?(a(),o("div",K,d(n.activeType==1?"\u5BF9\u65B9":e.name)+"\u540C\u610F\u5B58\u6863\u4F1A\u8BDD\u5185\u5BB9,\u4F60\u53EF\u4EE5\u7EE7\u7EED\u63D0\u4F9B\u670D\u52A1 ",1)):l("",!0),e.msgtype=="revoke"?(a(),o("div",Q," \u64A4\u56DE\u4E86\u4E00\u6761\u6D88\u606F ")):l("",!0)],64)):(a(),o(v,{key:1},[i("div",W,[i("img",{src:e.avatar,alt:"\u5934\u50CF"},null,8,X),e.from=="true"?(a(),o("div",Z,[i("i",null,[i("span",null,d(e.add_time),1),e.msgtype=="revoke"?(a(),o("span",$,"(\u5DF2\u64A4\u56DE)")):l("",!0)]),e.qw_name?(a(),o("span",ee,d(e.qw_name),1)):l("",!0)])):l("",!0),e.from=="false"?(a(),o("div",te,[e.qw_name?(a(),o("span",se,d(e.qw_name),1)):l("",!0),i("i",null,[i("span",null,d(e.add_time),1),e.msgtype=="revoke"?(a(),o("span",ae,"(\u5DF2\u64A4\u56DE)")):l("",!0)])])):l("",!0)]),i("div",oe,[g(y,{attributes:e},null,8,["attributes"])])],64))],2))),128))])])]),_:1},8,["onScrollToTop"])])])])}var pe=S(V,[["render",ie],["__scopeId","data-v-0429dfe5"]]);export{pe as default};
