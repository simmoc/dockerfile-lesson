
/**
 * 由 Fantastic-admin 提供技术支持
 * https://hooray.gitee.io/fantastic-admin/
 * Powered by Fantastic-admin
 * https://hooray.github.io/fantastic-admin/
 */
    
import{Q as R,w as J,a as r,q as f,t as s,R as T,S as j,J as M,L as v,A as d,v as G,x as $,F as X,G as Y,M as A,P as Z,o as ee,r as b,y as n,z as l,c as z,H as m,D as P,E as te,O as oe,a5 as ae,B as le}from"./vendor.d2559d84.js";import{_ as U}from"./plugin-vue_export-helper.21dcd24c.js";import{H as E,b as ne}from"./index.94e839d6.js";import{N as se}from"./index.4c9825d9.js";import{_ as re}from"./index.333b158c.js";import{_ as ue}from"./index.f1e12eef.js";const ie=x=>(X("data-v-df0f4bba"),x=x(),Y(),x),de={class:"table-content"},ce=ie(()=>s("div",{class:"tree-header"},"\u5DF2\u6709\u5173\u952E\u8BCD / \u5168\u90E8 \u6570\u5B57\u6570\u91CF",-1)),_e={class:"tree-scoll",style:{"max-height":"600px",overflow:"auto"}},pe=["onClick"],ge={class:"body-left overflow-ellipsis"},fe={key:0,class:"body-right"},me={key:1,class:"body-right"},he={props:{groupList:{type:Array},searchGroupName:{type:String,defualt:()=>""},isSearch:{type:Boolean,defualt:()=>!1},searchKeysVal:{type:Array,defualt:()=>[]}},emits:["updateGroupInfo","getKnowledgeList"],setup(x,{expose:L,emit:_}){const e=x,t=R({navaticeGroupId:null,navaticeDefault:0,showNum:!0});L({setNavaticeGroupId:D}),J(()=>e.isSearch,g=>{console.log("\u76D1\u542CisSearch",g),g?t.showNum=!1:t.showNum=!0}),J(()=>e.searchGroupName,g=>{console.log("\u76D1\u542CsearchGroupName",g),t.isSearch?t.showNum=!1:t.showNum=!0});function C(g){t.navaticeDefault=-1,t.navaticeGroupId=g.group_id,_("updateGroupInfo",g),_("getKnowledgeList",{group_id:g.group_id})}function D(g){g?(t.navaticeGroupId=g,t.navaticeDefault=-1):(t.navaticeGroupId=-1,t.navaticeDefault=0)}return(g,w)=>(r(),f("div",de,[ce,s("div",_e,[(r(!0),f(T,null,j(e.groupList,u=>(r(),f("div",{key:u.group_id,class:M(["tree-body",{"right-operate-additem":u.group_id===v(t).navaticeGroupId||u.sort===v(t).navaticeDefault}]),onClick:B=>C(u)},[s("div",ge,d(u.name),1),!e.isSearch||v(t).showNum?(r(),f("div",fe,d(u.keyword_num)+"/"+d(u.sale_script_num),1)):(r(),f("div",me,[G(s("div",{class:"group-item-blue-radus"},d(u.hit_num),513),[[$,u.hit_num&&u.group_id===v(t).navaticeGroupId]]),G(s("div",{class:"group-item-default-radus group-item-blue-radus"},d(u.hit_num),513),[[$,u.hit_num&&u.group_id!==v(t).navaticeGroupId]])]))],10,pe))),128))])]))}};var ve=U(he,[["__scopeId","data-v-df0f4bba"]]);const ye={class:"flex-direction-column flex flex-1"},ke={key:0},we={key:1,class:"right-table flex flex-1 flex-direction-column"},Ie={class:"table-head right-table-header flex-row flex-row-between"},be={class:"table-head-title"},xe={key:0},Le={class:"popover-content-box"},Ke={class:"popover-content"},Ne=["onClick"],Ve={key:0},Ge={key:1},Ce=m(" ... "),Se={key:0,class:"active-word-absolute"},$e=m(" \u7F16\u8F91 "),ze=m(" \u53D6\u6D88 "),Pe=m(" \u4FDD\u5B58 "),De={props:{tablePageContent:{type:Object,default(){return{groupLength:0}}},knowledgeList:{type:Array},groupNextInfo:{type:Object}},emits:["getGroupListInfo"],setup(x,{emit:L}){const _=x,e=A(!1),t=R({total_num:0,saleScripId:-1,searchKeysVal:[],select_reule:99,keysInfo:{page_num:1},keysList:[],tableTitle:[{label:"\u5185\u5BB9",prop:"content",type:"slot"},{label:"\u5173\u952E\u8BCD",prop:"keyword",type:"slot"}]}),C=Z();function D(p){console.log("keyVal",p),t.keysInfo.page_num=1,t.keysList=[],p&&t.keysList.findIndex(h=>{h.name})===-1&&(e.value=!0),w(p)}function g(p){C.push({name:"marketing-reply_Edit",query:{group_id:_.groupNextInfo.group_id,page_no:1,from_page:"reply",form_title:"\u7F16\u8F91\u63A8\u8350\u56DE\u590D",eventDetail:JSON.stringify(p)}})}function w(p){E.getKeywordList({search_name:p,page_num:t.keysInfo.page_num}).then(c=>{const{data:h}=c;console.warn("data",h),!!h.list.length&&(p?t.keysList=h.list:t.keysList=[...t.keysList,...h.list],t.total_num=h.total_num,console.warn("form.keysList",t.keysList))},c=>{console.log(c)})}function u(p){t.searchKeysVal=[],p.keyword_arr.forEach(c=>{t.searchKeysVal.push(c.keyword_name)}),console.log(t.searchKeysVal),t.saleScripId=p.sale_scrip_id,w()}function B(){t.saleScripId=-1}function K(){const p=[];t.searchKeysVal.forEach(c=>{p.push({name:c})}),E.updateKnowledgeKeys({keyword_arr:p,sale_script_id:t.saleScripId}).then(c=>{console.log(c),c.msg=="OK"&&(t.saleScripId=-1,L("getGroupListInfo"))},c=>{console.log(c)})}function q(){t.searchKeysVal[t.searchKeysVal.length-1].length>5&&(t.searchKeysVal.pop(),te.error({message:"\u5173\u952E\u8BCD\u5B57\u7B26\u957F\u5EA6\u6700\u591A\u4E3A5\u4E2A!"})),e.value=!1}function O(){C.push({name:"knowledgeBaseList",query:{type:"go-knowledgeBaseList",group_id:_.groupNextInfo.group_id,page_no:1,from_page:"replyList",form_title:"\u6DFB\u52A0\u5206\u5206\u7EC4"}})}return ee(()=>{document.body.addEventListener("click",p=>{let c=document.getElementsByClassName("table")[0];p.path.includes(c)||B()})}),(p,c)=>{const h=b("el-button"),i=b("el-popover"),o=b("el-tag"),y=b("el-option"),N=b("el-select"),V=b("el-table-column");return r(),f("div",ye,[_.tablePageContent.groupLength===0?(r(),f("div",ke,[n(se,null,{content:l(()=>[s("div",null,d(_.tablePageContent.content),1)]),button:l(()=>[s("div",null,[_.tablePageContent.btnContent=="\u53BB\u77E5\u8BC6\u5E93"?(r(),z(h,{key:0,type:"primary",size:"small",onClick:O},{default:l(()=>[m(d(_.tablePageContent.btnContent),1)]),_:1})):P("",!0)])]),_:1})])):(r(),f("div",we,[s("div",Ie,[s("div",be,[s("span",null,d(_.groupNextInfo?_.groupNextInfo.name:""),1)])]),n(re,{"table-title":v(t).tableTitle,"table-data":_.knowledgeList,style:{width:"100%","margin-top":"-24px"},"max-height":"630",class:"table"},{content:l(a=>[a.data.content&&a.data.content.length<50?(r(),f("div",xe,d(a.data.content),1)):P("",!0),a.data.content&&a.data.content.length>=50?(r(),z(i,{key:1,placement:"bottom",width:400,trigger:"hover","popper-class":"member-info-pop"},{reference:l(()=>[s("div",Ke,d(a.data.content.substring(0,50))+" ... ",1)]),default:l(()=>[s("div",Le,d(a.data.content),1)]),_:2},1024)):P("",!0)]),keyword:l(a=>[s("div",{class:"keys-item-tab",onClick:I=>u(a.data)},[G(s("div",null,[a.data.keyword_arr&&a.data.keyword_arr.length<=9?(r(),f("div",Ve,[(r(!0),f(T,null,j(a.data.keyword_arr,(I,S)=>(r(),z(o,{key:S,size:"mini",effect:"dark",class:"item-keys-margin"},{default:l(()=>[m(d(I.keyword_name),1)]),_:2},1024))),128))])):P("",!0),a.data.keyword_arr&&a.data.keyword_arr.length>9?(r(),f("div",Ge,[n(o,{class:"item-keys-margin"},{default:l(()=>[m(d(a.data.keyword_arr[0].keyword_name||""),1)]),_:2},1024),n(o,{class:"item-keys-margin"},{default:l(()=>[m(d(a.data.keyword_arr[1].keyword_name||""),1)]),_:2},1024),n(o,{class:"item-keys-margin"},{default:l(()=>[m(d(a.data.keyword_arr[3].keyword_name||""),1)]),_:2},1024),n(o,{class:"item-keys-margin"},{default:l(()=>[m(d(a.data.keyword_arr[4].keyword_name||""),1)]),_:2},1024),n(o,{class:"item-keys-margin"},{default:l(()=>[m(d(a.data.keyword_arr[5].keyword_name||""),1)]),_:2},1024),n(o,{class:"item-keys-margin"},{default:l(()=>[m(d(a.data.keyword_arr[6].keyword_name||""),1)]),_:2},1024),n(o,{class:"item-keys-margin"},{default:l(()=>[m(d(a.data.keyword_arr[7].keyword_name||""),1)]),_:2},1024),n(o,{class:"item-keys-margin"},{default:l(()=>[m(d(a.data.keyword_arr[8].keyword_name||""),1)]),_:2},1024),Ce])):P("",!0)],512),[[$,a.data.sale_scrip_id!==v(t).saleScripId]]),G(s("div",null,[n(N,{modelValue:v(t).searchKeysVal,"onUpdate:modelValue":c[0]||(c[0]=I=>v(t).searchKeysVal=I),class:"ipt-type keys-overflow-scoll",style:{width:"100%"},"allow-create":"","el-select":"",multiple:"",filterable:"","default-first-option":"",remote:"","remote-method":D,size:"small","no-match-text":"\u6682\u65E0\u6570\u636E","no-data-text":"\u6682\u65E0\u6570\u636E","reserve-keyword":"","multiple-limit":v(t).select_reule,onChange:q},{default:l(()=>[(r(!0),f(T,null,j(v(t).keysList,(I,S)=>(r(),z(y,{key:I.keyword_id||S,label:I.name,value:I.name},null,8,["label","value"]))),128)),e.value?(r(),f("div",Se," \u56DE\u8F66\u4F7F\u7528 ")):P("",!0)]),_:1},8,["modelValue","multiple-limit"])],512),[[$,a.data.sale_scrip_id===v(t).saleScripId]])],8,Ne)]),default:l(()=>[n(V,{label:"\u64CD\u4F5C",width:"190px",fixed:"right"},{default:l(({row:a})=>[G(s("div",null,[n(h,{type:"text",size:"mini",onClick:I=>g(a)},{default:l(()=>[$e]),_:2},1032,["onClick"])],512),[[$,a.sale_scrip_id!==v(t).saleScripId]]),G(s("div",null,[n(h,{type:"text",size:"mini",onClick:B},{default:l(()=>[ze]),_:1}),n(h,{type:"text",size:"mini",onClick:K},{default:l(()=>[Pe]),_:1})],512),[[$,a.sale_scrip_id==v(t).saleScripId]])]),_:1})]),_:1},8,["table-title","table-data"])]))])}}};var Be=U(De,[["__scopeId","data-v-5e5c24b2"]]);const Ee={class:"search-form flex flex-justify-between p24"},Te=["title"],je=m(" \u91CD\u7F6E "),qe=m(" \u67E5\u8BE2 "),Oe={class:"content-main"},Ae={class:"left"},Ue={class:"tree-head-left overflow-ellipsis"},Re={setup(x){const L=oe(),_=A(null),e=A({total_num:0,groupList:[],searchKeysVal:[],groupName:"",keysList:[],keysInfo:{search_name:"",page_num:1,page_size:5},tablePageContent:{groupLength:0,btnContent:"\u53BB\u77E5\u8BC6\u5E93",content:"\u6682\u65E0\u63A8\u8350\u56DE\u590D\uFF0C\u8BF7\u53BB\u77E5\u8BC6\u5E93\u6DFB\u52A0\u77E5\u8BC6!"},groupInfo:{type:1,get_sale_script_num:0,search_content:"",search_group_name:"",search_keyword_id_arr:[]},groupNextInfo:{},newGroupInfo:[],knowledgeList:[],knowledgeInfo:{group_id:1,search_content:"",search_keyword_id_arr:[]},select_reule:99,isSearch:!1});function t(){e.value.keysInfo.page_num=++e.value.keysInfo.page_num,e.value.total_num>e.value.keysList.length&&K()}function C(i){e.value.groupNextInfo.group_id=i.group_id,e.value.groupNextInfo.name=i.name}function D(){e.value.groupNextInfo={},w()}function g(){e.value.groupInfo.get_sale_script_num=1,e.value.groupInfo.search_content=e.value.knowledgeInfo.search_content,e.value.knowledgeInfo.search_content||e.value.searchKeysVal.length>0?e.value.isSearch=!0:e.value.isSearch=!1,w()}const w=ne(()=>{E.getGroupList(e.value.groupInfo).then(i=>{const{data:o}=i;if(console.log("teee",o),e.value.groupList=o,e.value.tablePageContent.groupLength=o.length,!o.length){e.value.groupList=[],e.value.knowledgeList=[];return}if(e.value.groupNextInfo.group_id){if(!o.some((V,a)=>{if(V.group_id==e.value.groupNextInfo.group_id)return e.value.groupNextInfo=o[a],!0})){e.value.groupNextInfo=o[0],e.value.knowledgeInfo.group_id=o[0].group_id,_.value.setNavaticeGroupId(e.value.groupNextInfo.group_id),u();return}e.value.knowledgeInfo.group_id=e.value.groupNextInfo.group_id,_.value.setNavaticeGroupId(e.value.groupNextInfo.group_id),u();return}let{knowledgeInfo:y}=e.value;if(e.value.groupNextInfo=JSON.parse(JSON.stringify(o[0])),e.value.knowledgeInfo.group_id=o[0].group_id,_.value.setNavaticeGroupId(o[0].group_id),L.query.group_id){y.group_id=L.query.group_id;const N=o.find(V=>V.group_id==L.query.group_id);e.value.groupNextInfo=N,_.value.setNavaticeGroupId(e.value.groupNextInfo.group_id),L.query.group_id=null}if(o[0].search_content){e.value.groupInfo.get_sale_script_num=1,y.search_content=o[0].search_content,u();return}e.value.groupInfo.get_sale_script_num=0,u()},i=>{console.log(i)})});function u(i){console.log("1111",i),i&&(e.value.knowledgeInfo.search_keyword_id_arr=e.value.searchKeysVal,e.value.knowledgeInfo.group_id=i.group_id,e.value.groupInfo.search_keyword_id_arr=e.value.searchKeysVal),E.getKnowledgeList(e.value.knowledgeInfo).then(o=>{const{data:y}=o;e.value.knowledgeList=y},o=>{console.log(o)})}function B(){e.value.knowledgeInfo.search_keyword_id_arr=e.value.searchKeysVal,e.value.groupInfo.search_keyword_id_arr=e.value.searchKeysVal,e.value.knowledgeInfo.search_content||e.value.searchKeysVal.length>0?e.value.isSearch=!0:e.value.isSearch=!1,w(),e.value.keysInfo.page_num=1,K("")}function K(i){E.getKeywordList({search_name:i,page_num:e.value.keysInfo.page_num}).then(o=>{const{data:y}=o;!y.list.length||(i?e.value.keysList=y.list:e.value.keysList=[...e.value.keysList,...y.list],e.value.total_num=y.total_num,console.warn("keysList",e.value.keysList))},o=>{console.log(o)})}function q(i){console.warn("keyVal",i),e.value.keysInfo.page_num=1,e.value.keysList=[],K(i)}function O(){e.value={groupList:[],searchKeysVal:[],groupName:"",keysList:[],keysInfo:{search_name:"",page_num:1,page_size:5},tablePageContent:{groupLength:0,btnContent:"\u53BB\u77E5\u8BC6\u5E93",content:"\u6682\u65E0\u63A8\u8350\u56DE\u590D\uFF0C\u8BF7\u53BB\u77E5\u8BC6\u5E93\u6DFB\u52A0\u77E5\u8BC6!"},groupInfo:{type:1,get_sale_script_num:0,search_content:"",search_group_name:"",search_keyword_id_arr:[]},groupNextInfo:{},newGroupInfo:[],knowledgeList:[],knowledgeInfo:{group_id:1,search_content:"",search_keyword_id_arr:[]},select_reule:99,isSearch:!1},_.value.setNavaticeGroupId(0),w(),K()}function p(){console.log("searchKeysVal",e.value.searchKeysVal),e.value.knowledgeInfo.search_keyword_id_arr=e.value.searchKeysVal,e.value.groupInfo.search_keyword_id_arr=e.value.searchKeysVal,w()}function c(){e.value.knowledgeInfo.search_keyword_id_arr=e.value.searchKeysVal,e.value.groupInfo.search_keyword_id_arr=e.value.searchKeysVal,e.value.groupInfo.search_content=e.value.knowledgeInfo.search_content,e.value.groupInfo.get_sale_script_num=1,e.value.knowledgeInfo.search_content||e.value.searchKeysVal.length>0?e.value.isSearch=!0:e.value.isSearch=!1,w()}function h(){w(),K()}return h(),(i,o)=>{const y=b("el-input"),N=b("el-form-item"),V=b("el-option"),a=b("el-select"),I=b("el-form"),S=b("el-button"),H=ve,F=Be,Q=ue,W=ae("el-select-loadmore");return r(),f("div",null,[s("div",Ee,[n(I,{modelValue:e.value.knowledgeInfo,"onUpdate:modelValue":o[2]||(o[2]=k=>e.value.knowledgeInfo=k),"label-position":"left",inline:!0,size:"small","label-width":"auto"},{default:l(()=>[n(N,{label:"\u6587\u672C\u5185\u5BB9 :",class:"mb0 mr24"},{default:l(()=>[n(y,{modelValue:e.value.knowledgeInfo.search_content,"onUpdate:modelValue":o[0]||(o[0]=k=>e.value.knowledgeInfo.search_content=k),clearable:"","show-word-limit":"",placeholder:"\u8BF7\u8F93\u5165\u6587\u672C\u5185\u5BB9",onKeyup:le(g,["enter"])},null,8,["modelValue","onKeyup"])]),_:1}),n(N,{label:"\u5173\u952E\u8BCD :",class:"mb0 mr24"},{default:l(()=>[G((r(),z(a,{modelValue:e.value.searchKeysVal,"onUpdate:modelValue":o[1]||(o[1]=k=>e.value.searchKeysVal=k),class:"keys-overflow-scoll","el-select":"",multiple:"",placeholder:"\u8F93\u5165\u5173\u952E\u8BCD",filterable:"",remote:"",style:{width:"206px"},"no-match-text":"no data","no-data-text":"no data","remote-method":q,"reserve-keyword":"","default-first-option":"",clearable:"","multiple-limit":e.value.select_reule,"popper-append-to-body":!1,onRemoveTag:p,onChange:B},{default:l(()=>[(r(!0),f(T,null,j(e.value.keysList,k=>(r(),z(V,{key:k.keyword_id,label:k.name,value:k.keyword_id},{default:l(()=>[s("span",{style:{float:"left",overflow:"hidden","text-overflow":"ellipsis"},title:k.name},d(k.name),9,Te)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue","multiple-limit"])),[[W,t,void 0,{stop:!0}]])]),_:1})]),_:1},8,["modelValue"]),n(I,{size:"small"},{default:l(()=>[n(S,{onClick:O},{default:l(()=>[je]),_:1}),n(S,{type:"primary",onClick:c},{default:l(()=>[qe]),_:1})]),_:1})]),n(Q,{class:"flex"},{default:l(()=>[s("div",Oe,[s("div",Ae,[s("div",Ue,[n(y,{modelValue:e.value.groupInfo.search_group_name,"onUpdate:modelValue":o[3]||(o[3]=k=>e.value.groupInfo.search_group_name=k),style:{width:"280px"},"prefix-icon":"el-icon-search",placeholder:"\u8BF7\u8F93\u5165\u5206\u7EC4\u540D\u79F0",size:"small",onInput:D},null,8,["modelValue"])]),s("div",null,[n(H,{ref_key:"groupTreeList",ref:_,"group-list":e.value.groupList,"search-group-name":e.value.groupInfo.search_group_name,"is-search":e.value.isSearch,onUpdateGroupInfo:C,onGetKnowledgeList:u},null,8,["group-list","search-group-name","is-search"])])])]),n(F,{"table-page-content":e.value.tablePageContent,"knowledge-list":e.value.knowledgeList,"group-next-info":e.value.groupNextInfo,"keys-list":e.value.keysList,class:M(["customer-tree",{"is-collapse":i.$store.state.settings.mode==="pc"&&i.$store.state.settings.sidebarCollapse}]),onGetGroupListInfo:v(w)},null,8,["table-page-content","knowledge-list","group-next-info","keys-list","class","onGetGroupListInfo"])]),_:1})])}}};var Xe=U(Re,[["__scopeId","data-v-05d34d4a"]]);export{Xe as default};
