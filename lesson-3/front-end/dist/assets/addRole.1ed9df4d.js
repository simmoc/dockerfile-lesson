
/**
 * 由 Fantastic-admin 提供技术支持
 * https://hooray.gitee.io/fantastic-admin/
 * Powered by Fantastic-admin
 * https://hooray.github.io/fantastic-admin/
 */
    
import{_ as O}from"./index.f1e12eef.js";import{M as v,o as z,r as w,a as c,q as o,t as b,R as T,S as R,K as D,A as x,c as $,z as m,H as q,y,D as p,C as H,F as K,G as W,P as G,O as P,a6 as J,L as Q,E as I}from"./vendor.d2559d84.js";import{_ as F}from"./plugin-vue_export-helper.21dcd24c.js";import{H as S}from"./index.94e839d6.js";import{v as X}from"./formValidate.137fd30a.js";import{_ as L}from"./index.60aa6862.js";const Y=l=>(K("data-v-b2473d06"),l=l(),W(),l),Z={class:"s-table"},ee={class:"table-tree table-head"},te={key:0},le={key:1},ae={key:0},ce={key:0,class:"el-icon-question"},oe=Y(()=>b("i",{class:"el-icon-question"},null,-1)),se={props:{checkedAllVal:{type:Object,default:()=>{}},tableData:{type:Array,default:()=>[]},tableTitle:{type:Array,default:()=>[]},disabled:{type:Boolean,default:!1}},setup(l,{expose:j}){const _=l,f=v(0);z(()=>{setTimeout(()=>{f.value=document.getElementsByClassName("s-table")[0].offsetWidth-1},300)});const E=(e,u)=>{let k=0;e.forEach(A=>{A.checked&&k++}),k===e.length?u.leafChecked=!0:u.leafChecked=!1,g(u)},g=e=>{console.log("\u5168\u9009\u4E2D"),e.children.length===0?e.checkAll=e.checked:(e.checked||(e.leafChecked=!1,e.children.forEach(u=>{u.checked=!1})),e.checkAll=e.leafChecked)};j({getLeafChecked:E,visiteChange:g});const C=e=>{e.checkAll=!e.checkAll,e.checked=e.checkAll,e.leafChecked=e.checkAll,e.children.forEach(u=>{u.checked=e.checkAll})};return(e,u)=>{const k=w("el-checkbox"),A=w("el-popover");return c(),o("div",Z,[b("ul",ee,[(c(!0),o(T,null,R(_.tableTitle,h=>(c(),o("li",{key:h.label,style:D(h.width>0?"flex:0 0 "+h.width+"px":"flex:1")},[b("span",null,x(h.label),1)],4))),128))]),l.tableData&&l.tableData.length>0?(c(),o("ul",te,[(c(!0),o(T,null,R(l.tableData,h=>(c(),o("li",{key:h.title,class:"table-tree"},[b("div",{style:D([l.tableTitle[0].width?"flex:0 0 "+l.tableTitle[0].width+"px":"flex:1",{display:"flex","align-items":"center"}])},[h.type==="check"?(c(),$(k,{key:0},{default:m(()=>[q(x(h.title),1)]),_:2},1024)):(c(),o("span",le,x(h.title),1))],4),l.tableData||l.tableData.length>0?(c(),o("ul",ae,[(c(!0),o(T,null,R(h.children,(s,B)=>(c(),o("li",{key:s+B,class:"table-tree"},[b("div",{style:D(l.tableTitle[1].width?"flex:0 0 "+l.tableTitle[1].width+"px":"flex:1")},[y(k,{modelValue:s.checked,"onUpdate:modelValue":r=>s.checked=r,disabled:l.disabled,onChange:r=>g(s)},{default:m(()=>[q(x(s.title),1)]),_:2},1032,["modelValue","onUpdate:modelValue","disabled","onChange"]),s.describe?(c(),o("i",ce)):p("",!0)],4),b("div",{style:D({flex:`0 0 ${f.value-l.tableTitle[0].width-l.tableTitle[1].width-l.tableTitle[3].width+"px"}`})},[(c(!0),o(T,null,R(s.children,(r,U)=>(c(),$(k,{key:U,modelValue:r.checked,"onUpdate:modelValue":t=>r.checked=t,disabled:!s.checked||l.disabled,onChange:t=>E(s.children,s)},{default:m(()=>[q(x(r.title)+" ",1),r.describe?(c(),$(A,{key:0,placement:"top-start",title:"",width:"200",trigger:"hover",content:r.describe},{reference:m(()=>[oe]),_:2},1032,["content"])):p("",!0)]),_:2},1032,["modelValue","onUpdate:modelValue","disabled","onChange"]))),128))],4),b("div",{style:{flex:"0 0 100px"},onClick:u[0]||(u[0]=H(()=>{},["prevent"]))},[y(k,{modelValue:s.checkAll,"onUpdate:modelValue":r=>s.checkAll=r,disabled:l.disabled,onClick:r=>C(s)},null,8,["modelValue","onUpdate:modelValue","disabled","onClick"])])]))),128))])):p("",!0)]))),128))])):p("",!0)])}}};var ne=F(se,[["__scopeId","data-v-b2473d06"]]);const re={key:0,class:"title"},de={key:1,class:"title"},ie={class:"fs16 c0 fwb"},ue={key:3,class:"title"},he={key:4,class:"mt20 tr"},fe=q("\u53D6\u6D88"),ke=q("\u786E\u5B9A"),me={setup(l){const j=v([{label:"\u6A21\u5757",prop:"title",width:"200"},{label:"\u8BBF\u95EE\u6743\u9650",prop:"title1",width:"300"},{label:"\u529F\u80FD\u6743\u9650",prop:"title"},{label:"\u5168\u9009",prop:"checkAll",width:"100"}]),_=v({}),f=v([]),E=v({menuKey:!1,menuButtonKey:!1}),g=v(null),C=G(),e=P(),u=v({name:[X(!0,"","blur","\u89D2\u8272\u540D\u79F0\u4E0D\u53EF\u4E3A\u7A7A")]}),k=v(null),A=()=>{k.value.validate(t=>{if(t){let a=[];f.value.forEach(n=>{n.children.length>0&&n.children.forEach(d=>{d.checked&&a.push({route:d.route,access:d.access}),d.children.length>0&&d.children.forEach(i=>{i.checked&&a.push({route:i.route,access:i.access})})})}),e.query.id?s(a):h(a)}})};z(()=>{B(),e.query.id&&(_.value.name=e.query.name)});const h=async t=>{(await S.addRoles({name:_.value.name,authority:t})).code===0&&(I.success("\u6DFB\u52A0\u6210\u529F\uFF01"),setTimeout(()=>{C.go(-1)},500))},s=async t=>{(await S.roleEdit({id:e.query.id,name:_.value.name,authority:t})).code===0&&(I.success("\u7F16\u8F91\u6210\u529F\uFF01"),setTimeout(()=>{C.go(-1)},500))},B=async()=>{let{data:t}=await S.authority();f.value=t,f.value.forEach(a=>{a.checked=!1,a.checkAll=!1,e.query.name==="\u8D85\u7EA7\u7BA1\u7406\u5458"&&(a.checked=!0,a.checkAll=!0),a.children.length>0&&a.children.forEach(n=>{n.checked=!1,n.checkAll=!1,e.query.name==="\u8D85\u7EA7\u7BA1\u7406\u5458"&&(n.checked=!0,n.checkAll=!0),n.children.length>0&&n.children.forEach(d=>{d.checked=!1,e.query.name==="\u8D85\u7EA7\u7BA1\u7406\u5458"&&(d.checked=!0)})})}),console.log("authorityOption",f),e.query.id&&U(e.query.id),console.log(t)},r=()=>{},U=async t=>{let{data:a}=await S.authorityRole({role_id:t});a.length>0&&(await J(),a.forEach(n=>{f.value.forEach(d=>{d.children.length>0&&d.children.forEach(i=>{i.route==n.route&&(i.checked=!0,g.value.visiteChange(i)),i.children.length>0&&i.children.forEach(V=>{V.route==n.route&&(V.checked=!0,g.value.getLeafChecked(i.children,i))})})})}),console.log(f.value))};return(t,a)=>{const n=w("el-input"),d=w("el-form-item"),i=w("el-form"),V=w("el-button"),M=O;return c(),$(M,null,{default:m(()=>[t.$route.query.type!=="checked"?(c(),o("div",re,[y(L,{title:t.\u57FA\u672C\u914D\u7F6E},null,8,["title"])])):p("",!0),t.$route.query.type==="checked"?(c(),o("div",de,[b("div",ie,x(t.$route.query.name),1)])):p("",!0),t.$route.query.type!=="checked"?(c(),$(i,{key:2,ref_key:"refForm",ref:k,model:_.value,"label-width":"120px","label-position":"top",style:{width:"520px"},rules:u.value},{default:m(()=>[y(d,{label:"\u89D2\u8272\u540D\u79F0",prop:"name"},{default:m(()=>[y(n,{modelValue:_.value.name,"onUpdate:modelValue":a[0]||(a[0]=N=>_.value.name=N),size:"small","show-word-limit":"",maxlength:"20"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])):p("",!0),t.$route.query.type!=="checked"?(c(),o("div",ue,[y(L,{title:"\u6743\u9650\u914D\u7F6E"})])):p("",!0),y(ne,{ref_key:"stable",ref:g,"table-title":j.value,"table-data":f.value,"show-check":!1,"checked-all-val":E.value,disabled:t.$route.query.type==="checked",onCheckAll:r},null,8,["table-title","table-data","checked-all-val","disabled"]),t.$route.query.type!=="checked"?(c(),o("div",he,[y(V,{size:"small",onClick:a[1]||(a[1]=N=>Q(C).go(-1))},{default:m(()=>[fe]),_:1}),y(V,{type:"primary",size:"small",onClick:A},{default:m(()=>[ke]),_:1})])):p("",!0)]),_:1})}}};var we=F(me,[["__scopeId","data-v-0a694725"]]);export{we as default};
