
/**
 * 由 Fantastic-admin 提供技术支持
 * https://hooray.gitee.io/fantastic-admin/
 * Powered by Fantastic-admin
 * https://hooray.github.io/fantastic-admin/
 */
    
var ee=Object.defineProperty;var U=Object.getOwnPropertySymbols;var te=Object.prototype.hasOwnProperty,se=Object.prototype.propertyIsEnumerable;var E=(u,i,n)=>i in u?ee(u,i,{enumerable:!0,configurable:!0,writable:!0,value:n}):u[i]=n,A=(u,i)=>{for(var n in i||(i={}))te.call(i,n)&&E(u,n,i[n]);if(U)for(var n of U(i))se.call(i,n)&&E(u,n,i[n]);return u};import{H as D}from"./index.94e839d6.js";import{_ as J,a as G,s as F,b as ae,c as le,d as ne,e as re}from"./tick@2x.1e6bc440.js";import{Q as z,M as H,w as K,o as q,r as y,a as p,q as v,t as r,y as _,L as o,B as oe,z as c,c as T,C as P,H as C,A as M,D as B,R as Q,S as W,U as Y,a6 as ce,V as ie}from"./vendor.d2559d84.js";import{d as de}from"./vuedraggable.umd.56963d08.js";import{_ as me}from"./plugin-vue_export-helper.21dcd24c.js";const pe={class:"selectMemberOrgTab"},ue={class:"filter"},_e=C(" \u641C\u7D22 "),be={class:"selectMemberWrap"},fe={class:"left"},ge={class:"memberTree"},ye={class:"custom-tree-node"},he=["onClick"],ve=["src"],Me=["onClick"],ke=["src"],Oe=["src"],xe={key:1,class:"member-box"},Te=["label","value","onClick"],Ce={class:"tag-item-left"},Se=["src"],Ve={class:"tag-item-left-txt"},we={style:{"max-width":"30%",overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap"}},Ie={class:"tag-item-parent-name"},Be={class:"right"},$e={class:"selectedMember"},Le={class:"tag-item-content"},Ne={class:"tag-item-left"},je=["src"],Ae={class:"tag-item-left-txt"},De={class:"tag-item-parent-name"},Fe={class:"tag-item-right-txt"},Ke={props:{isMultipleSelected:{type:Boolean,default:!0},isMultipleCheckBox:{type:Boolean,default:!1},dialogVisible:{type:Boolean,default:!1},param:{type:Object,default:function(){return{type:""}}},selectedMemberOrg:{type:Array,default:function(){return[]}},customSelectedFn:{type:Function,default:function(){return!0}},params:{type:Object,default:()=>({})}},setup(u,{expose:i}){const n=u,e=z({selectedMemberIds:[],memberTreeType:"default",memberList:[],keyword:"",treeData:[],defaultProps:{children:"children",label:"department_name",isLeaf:"isLeaf"},searchMemberResultList:[],expandedKeys:["d-1"],departmentIcon:J,memberIcon:G,selected:F,iconEnum:{CHAIN:"league-icon",GROUP:"group-icon",COMPANY:"company-icon",MEMBER:"member@2x",DEPARTMENT:"department-icon"}}),l=H([]);i({selectedMembers:l});const{proxy:f}=Y();K(()=>n.dialogVisible,t=>{!t&&n.selectedMemberOrg&&(l.value=JSON.parse(JSON.stringify(n.selectedMemberOrg)),e.selectedMemberIds=l.value.map(a=>a.id))}),K(()=>n.selectedMemberOrg,t=>{t&&(l.value=JSON.parse(JSON.stringify(t)),e.selectedMemberIds=l.value.map(a=>a.id))},{immediate:!0}),q(async()=>{});function $(t,a){L(a)}function L(t){l.value=t.checkedNodes}function S(t){let a=l.value.length;!n.customSelectedFn(t,a)||e.selectedMemberIds.includes(t.id)||(n.isMultipleSelected?(l.value.push(t),e.selectedMemberIds.push(t.id)):(l.value=[],e.selectedMemberIds=[],ce(()=>{l.value=[t],e.selectedMemberIds=[t.id]})))}function V(t){l.value.splice(t,1),e.selectedMemberIds.splice(t,1)}async function w(t,a){let m=e.selectedMemberIds.indexOf(a.id);m==-1?(S(a),f.$refs.tree.setCurrentKey(a.id)):V(m)}const N=async(t,a)=>{console.log("nodeLoad",t);const{isNextOrg:m}=t.data;if(t.level===0)return e.expandedKeys=[],e.treeData=await k(0),a(e.treeData);let b=[];m?b=await k(t.key):b=await I(t.key),e.expandedKeys=[t.key],a(b)};function j(){e.keyword="",e.memberTreeType="default"}async function d(){if(e.keyword){e.memberTreeType="search";let t=await I();e.searchMemberResultList=[...t]}else e.memberTreeType="default",e.treeData=await k(0)}async function g(t){S(t)}async function I(t){return console.log("-----------",n.params),new Promise(a=>{e.member_data=[];let m=A({},n.params);m.qw_parentid=t||"",m.keyword=e.keyword||"",n.isGroup&&(m.touch_object="GROUP"),D.getMemberDepartmentList(m).then(b=>{e.member_data=b.data,a(b.data)})})}async function k(t){return console.log("-----------",n.params),new Promise(a=>{var m=A({qw_parentid:t},n.params);n.isGroup&&(m.touch_object="GROUP"),D.getMemberDepartmentList(m).then(b=>{e.department_data=b.data,a(e.department_data)})})}function O(t){return new URL({"../../assets/images/selectMember/company-icon.png":ae,"../../assets/images/selectMember/department-icon.png":le,"../../assets/images/selectMember/department@2x.png":J,"../../assets/images/selectMember/group-icon.png":ne,"../../assets/images/selectMember/league-icon.png":re,"../../assets/images/selectMember/member@2x.png":G,"../../assets/images/selectMember/tick@2x.png":F}[`../../assets/images/selectMember/${e.iconEnum[t]}.png`],self.location).href}return(t,a)=>{const m=y("el-input"),b=y("el-button"),x=y("el-tooltip"),X=y("el-tree"),Z=y("el-tag");return p(),v("div",pe,[r("div",ue,[_(m,{modelValue:o(e).keyword,"onUpdate:modelValue":a[0]||(a[0]=s=>o(e).keyword=s),modelModifiers:{trim:!0},"prefix-icon":"el-icon-search",class:"del-end-clear-input",placeholder:"\u8BF7\u8F93\u5165\u6210\u5458\u540D\u79F0\u641C\u7D22",clearable:"",size:"mini",onClear:j,onKeyup:oe(d,["enter"])},null,8,["modelValue","onKeyup"]),_(b,{size:"mini",type:"primary",onClick:d},{default:c(()=>[_e]),_:1})]),r("div",be,[r("div",fe,[r("div",ge,[o(e).memberTreeType==="default"?(p(),T(X,{key:0,ref:"tree","default-expanded-keys":o(e).expandedKeys,"node-key":"id",props:o(e).defaultProps,"show-checkbox":n.isMultipleCheckBox,"check-strictly":"","render-after-expand":"",lazy:"",load:N,onCheck:$},{default:c(({node:s,data:h})=>[r("span",ye,[s.label&&s.label.length>12?(p(),T(x,{key:0,effect:"dark",content:s.label,placement:"top"},{default:c(()=>[r("span",{onClick:P(R=>w(s,h),["stop"])},[r("img",{class:"icon",src:O(h.type)},null,8,ve),C(" "+M(s.label.slice(0,12)+"..."),1)],8,he)]),_:2},1032,["content"])):(p(),v("span",{key:1,onClick:P(R=>w(s,h),["stop"])},[r("img",{class:"icon",src:O(h.type)},null,8,ke),C(" "+M(s.label),1)],8,Me)),o(e).selectedMemberIds.includes(h.id)?(p(),v("img",{key:2,class:"selected-tick",src:o(F),alt:"\u5DF2\u9009"},null,8,Oe)):B("",!0)])]),_:1},8,["default-expanded-keys","props","show-checkbox"])):B("",!0),o(e).memberTreeType==="search"?(p(),v("div",xe,[(p(!0),v(Q,null,W(o(e).searchMemberResultList,s=>(p(),v("div",{key:s.id,class:"member-item",label:s.department_name,value:s.id,onClick:P(h=>g(s),["stop"])},[r("div",Ce,[r("img",{src:s.isOrg?o(e).departmentIcon:o(e).memberIcon},null,8,Se),_(x,{effect:"dark",content:s.isOrg?s.department_name:s.member_name,placement:"top"},{default:c(()=>[r("span",Ve,M(s.isOrg?s.department_name:s.member_name),1)]),_:2},1032,["content"])]),r("div",we,[_(x,{effect:"dark",content:s.parent_name,placement:"top"},{default:c(()=>[r("span",Ie,M(s.parent_name),1)]),_:2},1032,["content"])])],8,Te))),128))])):B("",!0)])]),r("div",Be,[r("div",$e,[_(o(de),{modelValue:l.value,"onUpdate:modelValue":a[1]||(a[1]=s=>l.value=s),group:"type",animation:300,"item-key":"id",delay:100,onStart:a[2]||(a[2]=s=>t.drag=!0),onEnd:a[3]||(a[3]=s=>t.drag=!1)},{item:c(({element:s,index:h})=>[(p(),T(Z,{key:s.id,size:"small",closable:"",class:"tag-item",type:"info",onClose:R=>V(h)},{default:c(()=>[r("div",Le,[r("div",Ne,[r("img",{src:s.isOrg?o(e).departmentIcon:o(e).memberIcon},null,8,je),_(x,{effect:"dark",content:s.isOrg?s.department_name:s.member_name,placement:"top"},{default:c(()=>[r("span",Ae,M(s.isOrg?s.department_name:s.member_name),1)]),_:2},1032,["content"])]),r("div",De,[_(x,{effect:"dark",content:s.parent_name,placement:"top"},{default:c(()=>[r("span",Fe,M(s.parent_name),1)]),_:2},1032,["content"])])])]),_:2},1032,["onClose"]))]),_:1},8,["modelValue"])])])])])}}};var Pe=me(Ke,[["__scopeId","data-v-739df93e"]]);const Re={class:"add-member-dialog-com"},Ue={class:"add-member-dialog-main-wrap"},Ee={class:"dialog-footer"},Je=C("\u53D6 \u6D88"),Ge=C(" \u786E \u5B9A "),Xe={props:{inputPlaceholder:{type:String,default:"\u8BF7\u9009\u62E9"},isMultipleSelected:{type:Boolean,default:!0},isMultipleCheckBox:{type:Boolean,default:!1},writeBackSelectedMemberOrg:{type:Array,default:function(){return[]}},customSelectedFn:{type:Function},customInputValueFn:{type:Function},isGroup:{type:Boolean,default:()=>!1},title:{type:String,default:()=>"\u9009\u62E9\u6210\u5458"},params:{type:Object,default:()=>({})}},emits:["confirm"],setup(u,{expose:i,emit:n}){const e=u,l=z({headTypeArr:[],activeTab:"",selectedMemberOrg:[],inputValue:""}),f=H(!1),{proxy:$}=Y();i({dialogVisible:f,resetSelect:S}),K(()=>e.writeBackSelectedMemberOrg,d=>{d&&(l.selectedMemberOrg=JSON.parse(JSON.stringify(d)),e.customInputValueFn&&(l.inputValue=e.customInputValueFn(d)))},{immediate:!0,deep:!0}),q(async()=>{await N()});function L(){f.value=!0}function S(){l.inputValue=[],l.selectedMemberOrg=[],n("confirm",[])}function V(){f.value=!1}function w(){const d=$.$refs[`member-org-tab-${l.activeTab}`];Object.prototype.toString.call(d)==="[object Object]"?l.selectedMemberOrg=d.selectedMembers||[]:l.selectedMemberOrg=d[0].selectedMembers||[];let g=JSON.parse(JSON.stringify(l.selectedMemberOrg));n("confirm",g),e.customInputValueFn&&(l.inputValue=e.customInputValueFn(g)),f.value=!1}async function N(){D.getMemberType().then(d=>{l.headTypeArr=d.data,l.activeTab=l.headTypeArr[0].value}).catch(()=>{})}function j(){}return(d,g)=>{const I=y("el-tab-pane"),k=y("el-tabs"),O=y("el-button"),t=y("el-dialog");return p(),v("div",Re,[r("div",{class:"slot-box-pre",onClick:L},[ie(d.$slots,"default",{data:o(l).inputValue})]),_(t,{modelValue:f.value,"onUpdate:modelValue":g[1]||(g[1]=a=>f.value=a),"append-to-body":"","lock-scroll":"","custom-class":"add-member-dialog",title:e.title},{footer:c(()=>[r("span",Ee,[_(O,{onClick:V},{default:c(()=>[Je]),_:1}),_(O,{type:"primary",onClick:w},{default:c(()=>[Ge]),_:1})])]),default:c(()=>[r("div",Ue,[o(l).headTypeArr&&o(l).headTypeArr.length?(p(),T(k,{key:0,modelValue:o(l).activeTab,"onUpdate:modelValue":g[0]||(g[0]=a=>o(l).activeTab=a),type:"card",onTabClick:j},{default:c(()=>[(p(!0),v(Q,null,W(o(l).headTypeArr,a=>(p(),T(I,{key:a.value,label:a.label,name:a.value},{default:c(()=>[_(Pe,{ref_for:!0,ref:"member-org-tab-"+a.value,"is-group":e.isGroup,"is-multiple-selected":e.isMultipleSelected,"is-multiple-check-box":e.isMultipleCheckBox,param:{type:a.value},"selected-member-org":o(l).selectedMemberOrg,"dialog-visible":f.value,"custom-selected-fn":e.customSelectedFn,params:e.params},null,8,["is-group","is-multiple-selected","is-multiple-check-box","param","selected-member-org","dialog-visible","custom-selected-fn","params"])]),_:2},1032,["label","name"]))),128))]),_:1},8,["modelValue"])):B("",!0)])]),_:1},8,["modelValue","title"])])}}};export{Xe as _};
