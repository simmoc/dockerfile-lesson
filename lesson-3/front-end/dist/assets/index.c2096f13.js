
/**
 * 由 Fantastic-admin 提供技术支持
 * https://hooray.gitee.io/fantastic-admin/
 * Powered by Fantastic-admin
 * https://hooray.github.io/fantastic-admin/
 */
    
import{M as p,w as M,o as E,r as g,a as x,q as J,t as o,y as d,z as _,K as f,L as A,v as b,x as C,c as q,D,F as H,G as R,U as T}from"./vendor.d2559d84.js";import{H as F}from"./index.94e839d6.js";import{d as G}from"./vuedraggable.umd.56963d08.js";import{_ as K}from"./plugin-vue_export-helper.21dcd24c.js";const S=t=>(H("data-v-fed1b9ee"),t=t(),R(),t),P={class:"upload-container"},Q={class:"drag-image"},W={class:"images"},X=["onClick"],Y=S(()=>o("i",{class:"el-icon-close fs12 cfff"},null,-1)),Z=[Y],ee=S(()=>o("i",{class:"el-icon-plus"},null,-1)),te=[ee],ae={props:{action:{type:String,default:""},headers:{type:Object,default:()=>{}},data:{type:Object,default:()=>{}},name:{type:String,default:"file"},url:{type:Array,default:()=>[]},urlUnSync:{type:Array,default:()=>[]},max:{type:Number,default:3},size:{type:Number,default:2},width:{type:Number,default:150},height:{type:Number,default:150},placeholder:{type:String,default:""},notip:{type:Boolean,default:!1},ext:{type:Array,default:()=>["jpg","png","jpeg"]},disable:{type:Boolean,default:!1}},emits:["update:url","on-success","urlChange"],setup(t,{emit:i}){const s=t,{proxy:h}=T(),y=p(!1),n=p([]),a=p({imageViewerVisible:!1,dialogImageIndex:0,progress:{preview:"",percent:0},file:{file:"",file_type:"1"}}),m=p({imLength:0,list:[],hasChange:!1});M(()=>s.url,e=>{JSON.stringify(e)!==JSON.stringify(n.value)&&(n.value=JSON.parse(JSON.stringify(e)),m.value.list=n.value)},{deep:!0,immediate:!0}),E(()=>{});function $(){i("update:url",n.value),i("urlChange",n.value)}function I(e){a.value.dialogImageIndex=e,a.value.imageViewerVisible=!0}function V(){a.value.imageViewerVisible=!1}function N(e){let l=s.url;m.value.list.splice(e,1),l.splice(e,1),i("update:url",l),i("urlChange",l)}function k(e){const l=e.name.split("."),c=l[l.length-1],r=s.ext.indexOf(c)>=0,u=e.size/1024/1024<s.size;return r||h.$message.error(`\u4E0A\u4F20\u56FE\u7247\u53EA\u652F\u6301 ${s.ext.join(" / ")} \u683C\u5F0F\uFF01`),u||h.$message.error(`\u4E0A\u4F20\u56FE\u7247\u5927\u5C0F\u4E0D\u80FD\u8D85\u8FC7 ${s.size}MB\uFF01`),r&&u&&(a.value.progress.preview=URL.createObjectURL(e),a.value.file.file=e),r&&u}function j(e){a.value.progress.percent=~~e.percent,a.value.progress.percent==100&&(a.value.progress.preview="",a.value.progress.percent=0)}async function O(){y.value=!0;let e=await F.fileUpload(a.value.file,[],!0);if(e.code===200){await i("on-success",e.data);let l=s.url;l.push(e.data.file_url),i("update:url",l),i("urlChange",l),y.value=!1}}function z(e){i("on-success",e)}function B(e,l){console.log("\u6587\u4EF6\u6570\u91CF\u8D85\u51FA\u9650\u5236",e,l,s.max),h.$message.error("\u6587\u4EF6\u6570\u91CF\u8D85\u51FA\u9650\u5236")}return(e,l)=>{const c=g("el-image"),r=g("el-progress"),u=g("el-upload"),U=g("el-image-viewer");return x(),J("div",P,[o("div",Q,[d(A(G),{modelValue:n.value,"onUpdate:modelValue":l[0]||(l[0]=v=>n.value=v),disabled:s.disabled,"item-key":"index",onEnd:$},{item:_(({element:v,index:w})=>[o("div",W,[d(c,{src:v,style:f(`width:${t.width}px;height:${t.height}px;`),fit:"cover",onClick:L=>I(w)},null,8,["src","style","onClick"]),o("div",{class:"delet-btn",onClick:L=>N(w)},Z,8,X)])]),_:1},8,["modelValue","disabled"])]),b(d(u,{"show-file-list":!1,headers:t.headers,action:t.action,data:a.value,name:t.name,limit:s.max,multiple:"","file-list":m.value.list,"before-upload":k,"on-progress":j,"on-success":z,"http-request":O,"on-exceed":B,drag:"",class:"images-upload"},{default:_(()=>[o("div",{class:"image-slot",style:f(`width:${t.width}px;height:${t.height}px;`)},te,4),b(o("div",{class:"progress",style:f(`width:${t.width}px;height:${t.height}px;`)},[d(c,{src:a.value.progress.preview,style:f(`width:${t.width}px;height:${t.height}px;`),fit:"fill"},null,8,["src","style"]),d(r,{type:"circle",width:Math.min(t.width,t.height)*.8,percentage:a.value.progress.percent},null,8,["width","percentage"])],4),[[C,a.value.progress.percent]])]),_:1},8,["headers","action","data","name","limit","file-list"]),[[C,t.url.length<t.max]]),a.value.imageViewerVisible?(x(),q(U,{key:0,"url-list":t.url,"initial-index":a.value.dialogImageIndex,onClose:V},null,8,["url-list","initial-index"])):D("",!0)])}}};var oe=K(ae,[["__scopeId","data-v-fed1b9ee"]]);export{oe as _};
