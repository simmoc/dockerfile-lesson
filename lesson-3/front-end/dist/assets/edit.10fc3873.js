
/**
 * 由 Fantastic-admin 提供技术支持
 * https://hooray.gitee.io/fantastic-admin/
 * Powered by Fantastic-admin
 * https://hooray.github.io/fantastic-admin/
 */
    
import{_ as W,a as Z,b as ee,c as te,d as le,e as ae,f as A,g as se,h as ne}from"./write.74214fac.js";import{_ as oe}from"./index.f1e12eef.js";import{H as j}from"./index.94e839d6.js";import{o as ie,O as de,P as _e,M as ce,Q as re,r as g,a as d,q as m,L as s,t as a,A as b,D as h,y as n,z as o,a6 as B,R as k,J as C,S as O,c as v,F as me,G as ue,H as D,E as M,s as pe}from"./vendor.d2559d84.js";import{_ as fe}from"./plugin-vue_export-helper.21dcd24c.js";const w=T=>(me("data-v-5e1c8522"),T=T(),ue(),T),ye={class:"edit-page"},ge={key:0,class:"edit-content-head flex flex-justify-start flex-align-center pl24 pr24"},he={class:"edit-content-head-item"},be={class:"edit-content-head-item"},ve={class:"edit-content-head-item"},we={class:"edit-content-wrap event-edit-content-wrap pr24"},ke=w(()=>a("div",{class:"list-title"},[a("div",{class:"list-title-left"},[a("div",{class:"list-title-left-icon mr8"},"1"),a("div",{class:"list-title-left-txt"},"\u57FA\u7840\u4FE1\u606F")])],-1)),xe={class:"list-content pl24 pr24"},je={key:1,class:"list-content-detail"},De={class:"r-title"},Te={class:"r-text"},Ve=w(()=>a("span",{class:"color-label"},"\u4E8B\u4EF6\u6807\u8BC6\uFF1A",-1)),Oe={class:"color-txt mr32"},Me=w(()=>a("div",{class:"list-title"},[a("div",{class:"list-title-left"},[a("div",{class:"list-title-left-icon mr8"},"2"),a("div",{class:"list-title-left-txt"},"\u5173\u8054\u4E3B\u4F53")])],-1)),Ie={class:"list-content pl24 pr24"},Ue={class:"custom-subject-el-select-input-icon flex flex-justify-center flex-align-center"},Ee=["src"],Se={class:"custom-subject-option flex flex-justify-start flex-align-center"},Ne={class:"custom-subject-option-img-wrap flex flex-align-center"},ze=["src"],Ae={class:"pl8"},Be={key:1,class:"list-content-detail"},Ce={key:0,class:"r-text flex flex-justify-start flex-align-center"},qe=w(()=>a("span",{class:"color-label"},"\u4EBA\uFF1A",-1)),He=["src"],Re={class:"color-txt mr32"},Ge=w(()=>a("span",{class:"color-label"},"\u8D27\uFF1A",-1)),Pe={class:"color-txt mr32"},Fe=w(()=>a("span",{class:"color-label"},"\u573A\uFF1A",-1)),Ke={class:"color-txt"},Le={class:"list-title flex flex-justify-between"},Ye=w(()=>a("div",{class:"list-title-left"},[a("div",{class:"list-title-left-icon mr8"},"3"),a("div",{class:"list-title-left-txt"},"\u4E8B\u4EF6\u8981\u7D20")],-1)),$e=w(()=>a("img",{src:A,alt:"icon"},null,-1)),Qe=D(" \u5F00\u53D1\u6587\u6863 "),Xe=[$e,Qe],Je={class:"list-content pl24 pr24"},We={class:"edit-key-wrap"},Ze={class:"edit-table-wrap"},et={class:"operate-box flex flex-justify-between"},tt={class:"operate-box-item"},lt=D(" \u5220\u9664 "),at=D(" + \u65B0\u589E\u8981\u7D20 "),st={key:1,class:"flex flex-justify-end mt24"},nt=D("\u53D6\u6D88"),ot=D(" \u63D0\u4EA4 "),it={setup(T){function I(l){return new URL({"../../../../assets/images/eventManage/BUSINESS.svg":W,"../../../../assets/images/eventManage/THIRD.svg":Z,"../../../../assets/images/eventManage/YOUZAN.svg":ee,"../../../../assets/images/eventManage/addGroup.svg":te,"../../../../assets/images/eventManage/addInGroup.svg":le,"../../../../assets/images/eventManage/addItem.svg":ae,"../../../../assets/images/eventManage/doc_code.svg":A,"../../../../assets/images/eventManage/minusInGroup.svg":se,"../../../../assets/images/eventManage/write.svg":ne}[`../../../../assets/images/eventManage/${l}.svg`],self.location).href}ie(()=>{Y(S.query),L(),console.log(S.query.params)});const S=de(),N=_e(),U=ce(null),e=re({pageType:"add",type:"",id:"",platformOption:[],mainstay:{human:"",good:"",scene:""},form:{id:"",event_name:"",event_key:"",mainstay:{human:"",good:"",scene:""},events_elements:[{element_key:"",element_name:"",element_type:"",element_option_json:[],is_subject_field:"",subject_id:1,subject_type:""}]},rules:{event_name:[{required:!0,message:"\u8BF7\u8F93\u5165\u4E8B\u4EF6\u540D\u79F0",trigger:"blur"},{max:20,message:"\u957F\u5EA6zuicha \u4E2A\u5B57\u7B26",trigger:"blur"}],event_key:[{required:!0,message:"\u8BF7\u8F93\u5165\u4E8B\u6807\u8BC6",trigger:"blur"},{max:20,message:"\u957F\u5EA6zuicha \u4E2A\u5B57\u7B26",trigger:"blur"}],"mainstay.human":[{required:!0,message:"\u8BF7\u9009\u62E9\u5173\u8054\u4E3B\u4F53",trigger:"blur"}]},tableData:[],keyTypeOptions:[],humanOptions:[],goodOptions:[],sceneOptions:[],keyTypePlaceholder:{TEXT:"\u6587\u672C",NUMBER:"\u6570\u503C",DATETIME:"YYYY-MM-DD HH:MM:SS",BOOLEAN:"\u662F/\u5426/\u7A7A\u503C/\u975E\u7A7A"},eventDetail:{},isQW:!1}),q=async()=>{console.log("\u67E5\u65B0\u589E\u5B57\u6BB5\u7C7B\u578B==="),j.getEventsFieldType().then(l=>{console.log("\u7C7B\u578B",l),e.keyTypeOptions=l.data||{}}).catch(l=>{console.log(l,"\u9519\u8BEF\u63D0\u793A")})},H=()=>{j.getTagSubjectsKey().then(l=>{l.data.forEach(_=>{_.type==="HUMAN"?(e.humanOptions=_.data||[],console.log("\u4E3B\u9898\u9009\u62E9",e.humanOptions)):_.type==="GOOD"?e.goodOptions=_.data||[]:_.type==="SCENE"&&(e.sceneOptions=_.data||[])}),B(()=>{})}).catch(()=>{})},R=()=>{let l={events_id:e.form.id};j.getEventsUpdateData(l).then(i=>{console.log(i),e.eventDetail=i.data||{},e.tableData=i.data.events_elements}).catch(()=>{})},E=l=>{if(console.log(l),l.type==="HUMAN"){e.form.mainstay.human=l.id;let c=l.subject_id,r=e.humanOptions.filter(p=>p.id===c);r&&r[0]&&(e.mainstay.human.platform_type=r[0].platform_type)}else l.type==="GOOD"?e.form.mainstay.good=l.id:e.form.mainstay.scene=l.id;let i=!1,_=!1,u=!1;for(let c=0;c<e.tableData.length;c++)if(e.tableData[c].subject_type==="HUMAN"&&(_=!0),e.tableData[c].subject_type==="GOOD"&&(u=!0),e.tableData[c].subject_type===l.type){let r={element_key:l.key_field.name,element_name:l.key_field.label,element_type:l.key_field.type,element_option_json:l.key_field.options,is_subject_field:1,subject_id:l.id,subject_type:l.type};i=!0,e.tableData.splice(c,1,r)}if(!i){let c={element_key:l.key_field.name,element_name:l.key_field.label,element_type:l.key_field.type,element_option_json:l.key_field.options,is_subject_field:1,subject_id:l.id,subject_type:l.type};l.type==="HUMAN"?e.tableData.unshift(c):_&&u?e.tableData.splice(2,0,c):_&&!u||!_&&u?e.tableData.splice(1,0,c):e.tableData.unshift(c)}},G=l=>{e.tableData.splice(l,1)},z=()=>{console.log("\u6821\u9A8C\u5F00\u59CB");let l=e.tableData.length,i=!0,_=[],u=[];for(let c=0;c<l;c++){let r=e.tableData[c];if(r.element_key&&r.element_name&&(r.element_type==="OPTIONS"&&r.element_option_json&&r.element_option_json.length||r.element_type!=="OPTIONS")){let p=_.includes(r.element_key),y=u.includes(r.element_name);if((p||y)&&r.is_subject_field!=1){M({message:`\u8981\u7D20${p?"ID":y?"\u540D\u79F0":""}\u91CD\u590D\uFF0C\u8BF7\u91CD\u65B0\u8F93\u5165`,type:"warning"}),i=!1;break}else _.push(r.element_key),u.push(r.element_name);continue}else{i=!1;let p=!r.element_key,y=!r.element_name;p||y?M({message:`${p?"\u8981\u7D20ID":y?"\u8981\u7D20\u540D\u79F0":""}\u4E0D\u53EF\u4E3A\u7A7A\uFF0C\u8BF7\u8F93\u5165`,type:"warning"}):M({message:"\u9009\u9879\u5B58\u5728\u7A7A\u503C\uFF0C\u8BF7\u91CD\u65B0\u8F93\u5165",type:"warning"});break}}return console.log("\u6821\u9A8C\u7ED3\u675F",i),i},P=async()=>{e.pageType==="edit"?z()&&(e.form.events_elements=e.tableData,j.getEventsUpdate(e.form).then(i=>{console.log(i),N.push({path:"/event/eventManage"})}).catch(()=>{})):e.pageType==="add"&&(console.log(U.value,"**********"),U.value.validate(l=>{console.log(l,"==========="),l&&z()&&(e.form.events_elements=e.tableData,j.getEventsAdd(e.form).then(_=>{console.log(_),N.push({path:"/event/eventManage"})}).catch(_=>{M({message:_,type:"warning"})}))}))},F=()=>{let l={element_name:"",element_type:"TEXT",element_key:"",element_option_json:[],is_subject_field:"0",subject_id:"0",subject_type:""};e.tableData.push(l),B(()=>{document.getElementById("tagAddKeyBtn").scrollIntoView()})},K=()=>{let l="https://we-customer-api.freshgood.cn/events/apidoc/"+e.id;window.open(l)},L=()=>{q(),e.pageType!=="add"&&R()},Y=l=>{e.pageType=l&&l.type||"add",e.type=l&&l.type||"",e.id=l&&l.id||"",e.form.id=l&&l.id||"",e.timer=null,e.tableData=[],H(),console.log("\u9875\u9762\u7C7B\u578B\uFF1A",e.pageType)},$=()=>{pe.confirm("\u5F53\u524D\u9875\u9762\u672A\u4FDD\u5B58\uFF0C\u786E\u5B9A\u79BB\u5F00\u5F53\u524D\u9875\u9762\u5417\uFF1F","\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"}).then(()=>{window.history.go(-1)}).catch(()=>{})};return(l,i)=>{const _=g("el-input"),u=g("el-form-item"),c=g("el-col"),r=g("el-row"),p=g("el-option"),y=g("el-select"),x=g("el-table-column"),V=g("el-button"),Q=g("el-table"),X=g("el-form"),J=oe;return d(),m("div",ye,[["edit","detail"].includes(s(e).pageType)?(d(),m("div",ge,[a("div",he," \u521B\u5EFA\u6210\u5458\uFF1A"+b(s(e).eventDetail.creator_name||"\u2014"),1),a("div",be," \u521B\u5EFA\u65F6\u95F4\uFF1A"+b(s(e).eventDetail.create_time||"\u2014"),1),a("div",ve," \u66F4\u65B0\u65F6\u95F4\uFF1A"+b(s(e).eventDetail.update_time||"\u2014"),1)])):h("",!0),n(J,null,{default:o(()=>[a("div",null,[a("div",we,[n(X,{ref_key:"infoForm",ref:U,"label-position":"top","label-width":"80px",model:s(e).form,rules:s(e).rules,size:"mini"},{default:o(()=>[ke,a("div",xe,[["add"].includes(s(e).pageType)?(d(),m(k,{key:0},[n(r,{class:"form-item-row pl24"},{default:o(()=>[n(c,{sm:24,md:12,lg:12},{default:o(()=>[n(u,{label:"\u4E8B\u4EF6\u540D\u79F0\uFF1A",prop:"event_name",required:""},{default:o(()=>[n(_,{modelValue:s(e).form.event_name,"onUpdate:modelValue":i[0]||(i[0]=t=>s(e).form.event_name=t),placeholder:"\u8BF7\u8F93\u5165",maxlength:"20",clearable:"","show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),n(r,{class:"form-item-row pl24"},{default:o(()=>[n(c,{sm:24,md:12,lg:12},{default:o(()=>[n(u,{label:"\u4E8B\u4EF6\u6807\u8BC6\uFF1A",prop:"event_key",required:""},{default:o(()=>[n(_,{modelValue:s(e).form.event_key,"onUpdate:modelValue":i[1]||(i[1]=t=>s(e).form.event_key=t),placeholder:"\u8BF7\u8F93\u5165",maxlength:"20",clearable:"","show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})],64)):(d(),m("div",je,[a("div",De,b(s(e).eventDetail.event_name||"\u2014"),1),a("div",Te,[Ve,a("span",Oe,b(s(e).eventDetail.event_key||"\u2014"),1)])]))]),Me,a("div",Ie,[["add"].includes(s(e).pageType)?(d(),m(k,{key:0},[n(r,{class:"form-item-row pl24"},{default:o(()=>[n(c,{sm:24,md:12,lg:12},{default:o(()=>[n(u,{label:"\u4EBA",prop:"mainstay.human",required:""},{default:o(()=>[n(y,{modelValue:s(e).mainstay.human,"onUpdate:modelValue":i[2]||(i[2]=t=>s(e).mainstay.human=t),placeholder:"\u8BF7\u9009\u62E9",style:{width:"100%"},class:C(["custom-subject-el-select",s(e).mainstay.human?"select-text":"select-empty"]),"value-key":"id",onChange:E},{prefix:o(()=>[a("div",Ue,[s(e).mainstay.human.platform_type?(d(),m("img",{key:0,class:"img",src:I(s(e).mainstay.human.platform_type),alt:""},null,8,Ee)):h("",!0)])]),default:o(()=>[(d(!0),m(k,null,O(s(e).humanOptions,t=>(d(),v(p,{key:t.id,label:t.name,value:t},{default:o(()=>[a("div",Se,[a("div",Ne,[t.platform_type?(d(),m("img",{key:0,class:"img",src:I(t.platform_type),alt:""},null,8,ze)):h("",!0)]),a("div",Ae,b(t.name),1)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue","class"])]),_:1})]),_:1})]),_:1}),n(r,{class:"form-item-row pl24",gutter:0},{default:o(()=>[n(c,{sm:12,md:6,lg:6,class:"pr24"},{default:o(()=>[n(u,{label:"\u8D27",prop:"good",required:!1},{default:o(()=>[n(y,{modelValue:s(e).mainstay.good,"onUpdate:modelValue":i[3]||(i[3]=t=>s(e).mainstay.good=t),placeholder:"\u8BF7\u9009\u62E9",style:{width:"100%"},"value-key":"id",onChange:E},{default:o(()=>[(d(!0),m(k,null,O(s(e).goodOptions,t=>(d(),v(p,{key:t.id,label:t.name,value:t},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),n(c,{sm:12,md:6,lg:6},{default:o(()=>[n(u,{label:"\u573A",prop:"scene",required:!1},{default:o(()=>[n(y,{modelValue:s(e).mainstay.scene,"onUpdate:modelValue":i[4]||(i[4]=t=>s(e).mainstay.scene=t),placeholder:"\u8BF7\u9009\u62E9",style:{width:"100%"},"value-key":"id",onChange:E},{default:o(()=>[(d(!0),m(k,null,O(s(e).sceneOptions,t=>(d(),v(p,{key:t.id,label:t.name,value:t},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})],64)):(d(),m("div",Be,[s(e).eventDetail.mainstay?(d(),m("div",Ce,[qe,s(e).eventDetail.mainstay.human.tag_platform_type?(d(),m("img",{key:0,class:"r-text-img",src:I(s(e).eventDetail.mainstay.human.tag_platform_type)},null,8,He)):h("",!0),a("span",Re,b(s(e).eventDetail.mainstay.human.name),1),Ge,a("span",Pe,b(s(e).eventDetail.mainstay.good.name||"\u2014"),1),Fe,a("span",Ke,b(s(e).eventDetail.mainstay.scene.name||"\u2014"),1)])):h("",!0)]))]),a("div",Le,[Ye,["edit"].includes(s(e).pageType)?(d(),m("div",{key:0,class:"doc-btn",onClick:K},Xe)):h("",!0)]),a("div",Je,[a("div",We,[a("div",Ze,[n(Q,{data:s(e).tableData,style:{width:"100%"},size:"mini","header-row-class-name":"tag-sub-edit-table-head"},{default:o(()=>[n(x,{label:"\u8981\u7D20ID",width:"180"},{default:o(t=>[n(_,{modelValue:t.row.element_key,"onUpdate:modelValue":f=>t.row.element_key=f,placeholder:"\u8BF7\u8F93\u5165",size:"mini",maxlength:"20",disabled:t.row.is_subject_field==1||!!t.row.id},null,8,["modelValue","onUpdate:modelValue","disabled"])]),_:1}),n(x,{label:"\u8981\u7D20\u540D\u79F0",width:"180"},{default:o(t=>[n(_,{modelValue:t.row.element_name,"onUpdate:modelValue":f=>t.row.element_name=f,placeholder:"\u8BF7\u8F93\u5165",size:"mini",maxlength:"10",disabled:t.row.is_subject_field==1||!!t.row.id},null,8,["modelValue","onUpdate:modelValue","disabled"])]),_:1}),n(x,{label:"\u8981\u7D20\u7C7B\u578B",width:"120"},{default:o(t=>[n(y,{modelValue:t.row.element_type,"onUpdate:modelValue":f=>t.row.element_type=f,placeholder:"\u8BF7\u9009\u62E9",size:"mini",disabled:t.row.is_subject_field==1||!!t.row.id},{default:o(()=>[(d(!0),m(k,null,O(s(e).keyTypeOptions,f=>(d(),v(p,{key:f.value,label:f.label,value:f.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","disabled"])]),_:1}),n(x,{label:"\u503C","min-width":"280"},{default:o(t=>[t.row.element_type==="OPTIONS"?(d(),m(k,{key:0},[t.row.is_subject_field!==1||!!t.row.id?(d(),v(y,{key:0,modelValue:t.row.element_option_json,"onUpdate:modelValue":f=>t.row.element_option_json=f,style:{width:"100%"},size:"mini",multiple:"",filterable:"","allow-create":"","default-first-option":"",placeholder:"\u8BF7\u8F93\u5165",disabled:t.row.is_subject_field==1||!!t.row.id,class:C([t.row.is_subject_field==1||!!t.row.id?"not_edit":""])},null,8,["modelValue","onUpdate:modelValue","disabled","class"])):h("",!0)],64)):(d(),v(_,{key:1,disabled:"",placeholder:s(e).keyTypePlaceholder[t.row.element_type]||"-",size:"mini"},null,8,["placeholder"]))]),_:1}),n(x,{label:"\u64CD\u4F5C",width:"180"},{default:o(t=>[a("div",et,[a("div",tt,[t.row.is_subject_field!=1&&!t.row.id?(d(),v(V,{key:0,class:"fw400",size:"mini",type:"text",onClick:f=>G(t.$index,t.row)},{default:o(()=>[lt]),_:2},1032,["onClick"])):h("",!0)])])]),_:1})]),_:1},8,["data"]),["add","edit"].includes(s(e).pageType)?(d(),v(V,{key:0,id:"tagAddKeyBtn",size:"mini",style:{width:"100%","margin-top":"10px",border:"1px dashed #eee"},onClick:F},{default:o(()=>[at]),_:1})):h("",!0),["add","edit"].includes(s(e).pageType)?(d(),m("div",st,[n(V,{size:"mini",onClick:$},{default:o(()=>[nt]),_:1}),n(V,{size:"mini",type:"primary",onClick:P},{default:o(()=>[ot]),_:1})])):h("",!0)])])])]),_:1},8,["model","rules"])])])]),_:1})])}}};var ut=fe(it,[["__scopeId","data-v-5e1c8522"]]);export{ut as default};
