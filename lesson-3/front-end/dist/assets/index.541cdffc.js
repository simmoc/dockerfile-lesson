
/**
 * 由 Fantastic-admin 提供技术支持
 * https://hooray.gitee.io/fantastic-admin/
 * Powered by Fantastic-admin
 * https://hooray.github.io/fantastic-admin/
 */
    
import{_ as L}from"./index.5931791c.js";import{E as r,r as p,a as u,q as g,y as c,z as d,t as i,D as f,A as h,v as G,x as b,c as D,C as N,J as k,F as V,G as E}from"./vendor.d2559d84.js";import{H as _}from"./index.94e839d6.js";import{d as x}from"./vuedraggable.umd.56963d08.js";import{a as S}from"./drag.56588ea6.js";import{_ as j}from"./plugin-vue_export-helper.21dcd24c.js";import"./sortable.esm.81321d43.js";const q={};const B={name:"TreeDrag",components:{draggable:x},props:{modelValue:{type:Object},groupList:{type:Array},isSearch:{type:Boolean,default:()=>!1},getList:{type:Function},getGroupList:{type:Function},setTreeChecked:{type:Function}},emits:["update:modelValue"],setup(){},data(){return{acitveRightHandle:null,navaticeGroupId:null,dialogVisible:!1,groupName:"",dialogGroupDel:!1,groupId:-1,navaticeDefault:0,updGroupInfo:{name:"",goods_class_id:1},newGroupList:[],showNum:!0,visible:!1,dragList:[]}},watch:{isSearch(e){console.log("\u76D1\u542C",e),e?this.showNum=!0:this.showNum=!1},search_group_name(){this.isSearch?this.showNum=!0:this.showNum=!1},groupList(e){console.log("\u76D1\u542Cgroup",e),this.dragList=JSON.parse(JSON.stringify(e)),console.log("dragList",this.dragList)}},mounted(){document.body.addEventListener("click",e=>{Array.from(document.getElementsByClassName("crud-classify-tree-operate-popover")).includes(e.path[0])||this.dragList.length>0&&this.dragList.forEach(t=>{t.visible=!1})})},methods:{showPop(e){this.dragList.length>0&&this.dragList.forEach(o=>{o.visible=!1}),e.visible=!0},handleClickRightOperateBtn(e){this.acitveRightHandle=e},getImageUrl(e){return new URL(e,q.url).href},handleGroupLeave(){this.acitveRightHandle=null},handlerGroupDelete(e){this.dialogGroupDel=!0,this.groupId=e},handlerGroupDel(){this.delGroup()},delGroup(){_.deleteGoodsCate({goods_class_id:this.groupId}).then(e=>{e.code===200&&(r({message:"\u5220\u9664\u6210\u529F",type:"success",showClose:!0}),this.dialogGroupDel=!1,this.setTreeChecked(0),console.log(e))},e=>{r.error({message:`\u5220\u9664\u5931\u8D25${e}`,showClose:!0})})},handlerEditName(e){this.dialogVisible=!0,this.updGroupInfo.goods_class_id=e.goods_class_id,this.groupName=e.name},handlerGroupEdit(){if(!this.groupName){r({message:"\u5206\u7C7B\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A!",type:"warning",showClose:!0});return}this.updGroupInfo.name=this.groupName,console.log(this.updGroupInfo),_.editGoodsCate(this.updGroupInfo).then(e=>{if(e.msg==="\u5F53\u524D\u5206\u7C7B\u5DF2\u5B58\u5728\uFF0C\u8BF7\u91CD\u65B0\u8F93\u5165\uFF01"){r({message:"\u5F53\u524D\u5206\u7C7B\u5DF2\u5B58\u5728\uFF0C\u8BF7\u91CD\u65B0\u8F93\u5165\uFF01",type:"warning",showClose:!0});return}else if(e.code===200){r.success({message:"\u64CD\u4F5C\u6210\u529F"}),this.groupName="",this.dialogVisible=!1;let o=this.dragList.findIndex(t=>t.goods_class_id===this.updGroupInfo.goods_class_id);this.setTreeChecked(o)}},e=>{console.log(e)})},dragEnd({newIndex:e}){if(console.log(e),this.isSearch)return;const o=this.dragList.map((t,m)=>(t.sort=20-m,{goods_class_id:t.goods_class_id,sort:t.sort}));this.navaticeGroupId=null,_.updateGoodsCatesSort({goods_class_list:o}).then(()=>{this.handlerGroupKnowledge(this.dragList[e])},t=>{console.log(t)})},handlerGroupKnowledge(e){console.log("\u70B9\u51FB\u8282\u70B9",e),this.navaticeDefault=-1,e&&(this.navaticeGroupId=e.goods_class_id,console.log(this.navaticeGroupId),this.$emit("update:modelValue",e),console.log(e.goods_class_id),this.getList(e.goods_class_id))},setNavaticeGroupId(e){e?(this.navaticeGroupId=e,this.navaticeDefault=-1):(this.navaticeGroupId=-1,this.navaticeDefault=0)}}},y=e=>(V("data-v-5eb92eb2"),e=e(),E(),e),H=["onClick"],O={key:0,class:"item-group-trag-icon",src:S,alt:""},R={class:"tree-group-name"},T={key:0},F=["onMouseleave"],M=["onClick"],U=["onClick"],A=["onClick"],J={class:"dialog-body"},K=y(()=>i("div",{class:"group_name"},"\u5206\u7C7B\u540D\u79F0",-1)),z=y(()=>i("div",{class:"dialog-body"},[i("div",{class:"group_name"},"\u662F\u5426\u5220\u9664\u8BE5\u5546\u54C1\u5206\u7C7B")],-1));function P(e,o,t,m,a,l){const w=p("el-popover"),C=p("draggable"),I=p("el-input"),v=L;return u(),g("div",null,[c(C,{modelValue:a.dragList,"onUpdate:modelValue":o[0]||(o[0]=s=>a.dragList=s),disabled:t.isSearch,onEnd:l.dragEnd},{item:d(({element:s})=>[i("div",{class:k(["item-class",{"right-operate-additem":s.goods_class_id===a.navaticeGroupId|s.sort===a.navaticeDefault}]),onClick:n=>l.handlerGroupKnowledge(s)},[i("div",null,[t.isSearch?f("",!0):(u(),g("img",O)),i("span",R,h(s.name),1)]),i("div",null,[t.isSearch?(u(),g("div",T,[G(i("div",{class:"group-item-blue-radus"},h(s.hits_num),513),[[b,s.hits_num&&s.goods_class_id===a.navaticeGroupId]]),G(i("div",{class:"group-item-default-radus group-item-blue-radus"},h(s.hits_num),513),[[b,s.hits_num&&s.goods_class_id!==a.navaticeGroupId]])])):f("",!0),(u(),D(w,{key:s.id,visible:s.visible,"popper-class":"crud-classify-tree-operate-popover",placement:"right",offset:20,"popper-options":{boundariesElement:"viewport",removeOnDestroy:!0},trigger:"manual"},{reference:d(()=>[i("i",{class:"right-oper-btn el-icon-more",onClick:N(n=>l.showPop(s),["stop"])},null,8,A)]),default:d(()=>[i("div",{class:"right-operate-item-goods",onMouseleave:n=>s.visible=!1},[i("div",{class:"play",onClick:n=>l.handlerEditName(s)}," \u7F16\u8F91\u540D\u79F0 ",8,M),i("div",{class:"play",onClick:n=>l.handlerGroupDelete(s.goods_class_id)}," \u5220\u9664 ",8,U)],40,F)]),_:2},1032,["visible"]))])],10,H)]),_:1},8,["modelValue","disabled","onEnd"]),c(v,{title:"\u7F16\u8F91\u5206\u7C7B\u540D\u79F0","dialog-visible":a.dialogVisible,width:"400px","confirm-fn":l.handlerGroupEdit,onCancel:o[2]||(o[2]=s=>a.dialogVisible=!1)},{default:d(()=>[i("div",J,[K,c(I,{modelValue:a.groupName,"onUpdate:modelValue":o[1]||(o[1]=s=>a.groupName=s),autocomplete:"off",maxlength:5,placeholder:"\u8BF7\u8F93\u5165\u5206\u7C7B\u540D\u79F0","show-word-limit":""},null,8,["modelValue"])])]),_:1},8,["dialog-visible","confirm-fn"]),c(v,{title:"\u63D0\u793A","dialog-visible":a.dialogGroupDel,width:"400px","confirm-fn":l.handlerGroupDel,onCancel:o[3]||(o[3]=s=>a.dialogGroupDel=!1)},{default:d(()=>[z]),_:1},8,["dialog-visible","confirm-fn"])])}var se=j(B,[["render",P],["__scopeId","data-v-5eb92eb2"]]);export{se as default};
