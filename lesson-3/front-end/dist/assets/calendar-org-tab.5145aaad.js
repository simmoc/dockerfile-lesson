
/**
 * 由 Fantastic-admin 提供技术支持
 * https://hooray.gitee.io/fantastic-admin/
 * Powered by Fantastic-admin
 * https://hooray.github.io/fantastic-admin/
 */
    
import{_ as j,a as D,s as v,b as H,c as q,d as J,e as G}from"./tick@2x.1e6bc440.js";import{Q,M as W,w as Y,o as X,r as g,a as d,q as f,t as a,y as _,L as o,B as Z,z as m,c as x,C as w,H as C,A as b,D as O,R as ee,S as te,U as se,a6 as ne}from"./vendor.d2559d84.js";import{d as ae}from"./vuedraggable.umd.56963d08.js";import{H as K}from"./index.94e839d6.js";import{_ as le}from"./plugin-vue_export-helper.21dcd24c.js";import"./sortable.esm.81321d43.js";const re={class:"selectMemberOrgTab"},oe={class:"filter"},ce=C(" \u641C\u7D22 "),ie={class:"selectMemberWrap"},de={class:"left"},me={class:"memberTree"},pe={class:"custom-tree-node"},ue=["onClick"],_e=["src"],fe=["onClick"],be=["src"],he=["src"],ge={key:1,class:"member-box"},ye=["label","value","onClick"],ke={class:"tag-item-left"},Me=["src"],ve={class:"tag-item-left-txt"},xe={style:{"max-width":"30%",overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap"}},we={class:"tag-item-parent-name"},Ce={class:"right"},Oe={class:"selectedMember"},Te={class:"tag-item-content"},Ne={class:"tag-item-left"},Ie=["src"],Se={class:"tag-item-left-txt"},Le={class:"tag-item-parent-name"},Be={class:"tag-item-right-txt"},je={props:{isMultipleSelected:{type:Boolean,default:!0},isMultipleCheckBox:{type:Boolean,default:!1},dialogVisible:{type:Boolean,default:!1},param:{type:Object,default:function(){return{type:""}}},selectedMemberOrg:{type:Array,default:function(){return[]}},customSelectedFn:{type:Function,default:function(){return!0}},touchObject:{type:String}},setup(V,{expose:E}){const u=V,e=Q({selectedMemberIds:[],memberTreeType:"default",memberList:[],keyword:"",treeData:[],defaultProps:{children:"children",label:"department_name",isLeaf:"isLeaf"},searchMemberResultList:[],expandedKeys:["d-1"],departmentIcon:j,memberIcon:D,selected:v,iconEnum:{CHAIN:"league-icon",GROUP:"group-icon",COMPANY:"company-icon",MEMBER:"member@2x",DEPARTMENT:"department-icon"}}),i=W([]);E({selectedMembers:i,handleNodeExpand:I});const{proxy:y}=se();Y(()=>u.selectedMemberOrg,t=>{t&&(i.value=JSON.parse(JSON.stringify(t)),e.selectedMemberIds=i.value.map(n=>n.id))},{immediate:!0}),X(async()=>{e.treeData=await h(0)});function $(t,n){R(n)}function R(t){i.value=t.checkedNodes}function k(t){let n=i.value.length;!u.customSelectedFn(t,n)||e.selectedMemberIds.includes(t.id)||(u.isMultipleSelected?(i.value.push(t),e.selectedMemberIds.push(t.id)):(i.value=[],e.selectedMemberIds=[],ne(()=>{i.value=[t],e.selectedMemberIds=[t.id]})))}function T(t){i.value.splice(t,1),e.selectedMemberIds.splice(t,1)}async function N(t,n){let r=e.selectedMemberIds.indexOf(n.id);r==-1?(k(n),y.$refs.tree.setCurrentKey(n.id)):T(r)}async function I(t,n){if(!t.isLeaf){if(n.childNodes&&n.childNodes.length)return;let r=t.isNextOrg,c=n.key,l=[];r?l=await h(c):l=await M(c),l&&l.length&&y.$refs.tree.updateKeyChildren(c,l)}}async function P(t,n){if(console.log(t),!t.isOrg){u.isMultipleCheckBox||k(t);return}if(n.childNodes&&n.childNodes.length)return;let r=t.isNextOrg,c=n.key,l=[];r?l=await h(c):l=await M(c),l&&l.length&&(console.log("\u8BF7\u6C42children===",l),y.$refs.tree.updateKeyChildren(c,l),e.expandedKeys=[t.id])}function U(){e.keyword="",e.memberTreeType="default"}async function S(){if(e.keyword){e.memberTreeType="search";let t=await M();e.searchMemberResultList=[...t]}else e.memberTreeType="default",e.treeData=await h(0)}async function A(t){e.keyword=t.department_name,e.memberTreeType="default",e.treeData=await h(0),e.expandedKeys=[t.id],k(t)}async function M(t){return new Promise(n=>{e.member_data=[];let r={};r.id=t||"",r.keyword=e.keyword||"",r.touch_object=u.touchObject||"",K.getDepartmentMemberList(r).then(c=>{e.member_data=c.data,n(c.data),console.log("\u5F97\u5230\u7ED3\u679C",e.department_data)})})}async function h(t){return new Promise(n=>{let r={};r.qw_parentid=t,r.touch_object=u.touchObject||"",K.getMemberDepartmentList(r).then(c=>{e.department_data=c.data,n(e.department_data)})})}function L(t){return new URL({"../../../../assets/images/selectMember/company-icon.png":H,"../../../../assets/images/selectMember/department-icon.png":q,"../../../../assets/images/selectMember/department@2x.png":j,"../../../../assets/images/selectMember/group-icon.png":J,"../../../../assets/images/selectMember/league-icon.png":G,"../../../../assets/images/selectMember/member@2x.png":D,"../../../../assets/images/selectMember/tick@2x.png":v}[`../../../../assets/images/selectMember/${e.iconEnum[t]}.png`],self.location).href}return(t,n)=>{const r=g("el-input"),c=g("el-button"),l=g("el-tooltip"),z=g("el-tree"),F=g("el-tag");return d(),f("div",re,[a("div",oe,[_(r,{modelValue:o(e).keyword,"onUpdate:modelValue":n[0]||(n[0]=s=>o(e).keyword=s),modelModifiers:{trim:!0},"prefix-icon":"el-icon-search",class:"del-end-clear-input",placeholder:"\u8BF7\u8F93\u5165\u6210\u5458\u540D\u79F0\u641C\u7D22",clearable:"",size:"mini",onClear:U,onKeyup:Z(S,["enter"])},null,8,["modelValue","onKeyup"]),_(c,{size:"mini",type:"primary",onClick:S},{default:m(()=>[ce]),_:1})]),a("div",ie,[a("div",de,[a("div",me,[o(e).memberTreeType==="default"?(d(),x(z,{key:0,ref:"tree",data:o(e).treeData,"default-expanded-keys":o(e).expandedKeys,"node-key":"id",props:o(e).defaultProps,"highlight-current":!0,"show-checkbox":u.isMultipleCheckBox,"check-strictly":"","render-after-expand":"","default-expand-all":!0,onNodeClick:P,onNodeExpand:I,onCheck:$},{default:m(({node:s,data:p})=>[a("span",pe,[s.label&&s.label.length>12?(d(),x(l,{key:0,effect:"dark",content:s.label,placement:"top"},{default:m(()=>[a("span",{onClick:w(B=>N(s,p),["stop"])},[a("img",{class:"icon",src:L(p.type)},null,8,_e),C(" "+b(s.label.slice(0,12)+"..."),1)],8,ue)]),_:2},1032,["content"])):(d(),f("span",{key:1,onClick:w(B=>N(s,p),["stop"])},[a("img",{class:"icon",src:L(p.type)},null,8,be),C(" "+b(s.label),1)],8,fe)),o(e).selectedMemberIds.includes(p.id)?(d(),f("img",{key:2,class:"selected-tick",src:o(v),alt:"\u5DF2\u9009"},null,8,he)):O("",!0)])]),_:1},8,["data","default-expanded-keys","props","show-checkbox"])):O("",!0),o(e).memberTreeType==="search"?(d(),f("div",ge,[(d(!0),f(ee,null,te(o(e).searchMemberResultList,s=>(d(),f("div",{key:s.id,class:"member-item",label:s.department_name,value:s.id,onClick:w(p=>A(s),["stop"])},[a("div",ke,[a("img",{src:s.isOrg?o(e).departmentIcon:o(e).memberIcon},null,8,Me),_(l,{effect:"dark",content:s.isOrg?s.department_name:s.member_name,placement:"top"},{default:m(()=>[a("span",ve,b(s.isOrg?s.department_name:s.member_name),1)]),_:2},1032,["content"])]),a("div",xe,[_(l,{effect:"dark",content:s.parent_name,placement:"top"},{default:m(()=>[a("span",we,b(s.parent_name),1)]),_:2},1032,["content"])])],8,ye))),128))])):O("",!0)])]),a("div",Ce,[a("div",Oe,[_(o(ae),{modelValue:i.value,"onUpdate:modelValue":n[1]||(n[1]=s=>i.value=s),group:"type",animation:300,"item-key":"id",delay:100,onStart:n[2]||(n[2]=s=>t.drag=!0),onEnd:n[3]||(n[3]=s=>t.drag=!1)},{item:m(({element:s,index:p})=>[(d(),x(F,{key:s.id,size:"small",closable:"",class:"tag-item",type:"info",onClose:B=>T(p)},{default:m(()=>[a("div",Te,[a("div",Ne,[a("img",{src:s.isOrg?o(e).departmentIcon:o(e).memberIcon},null,8,Ie),_(l,{effect:"dark",content:s.isOrg?s.department_name:s.member_name,placement:"top"},{default:m(()=>[a("span",Se,b(s.isOrg?s.department_name:s.member_name),1)]),_:2},1032,["content"])]),a("div",Le,[_(l,{effect:"dark",content:s.parent_name,placement:"top"},{default:m(()=>[a("span",Be,b(s.parent_name),1)]),_:2},1032,["content"])])])]),_:2},1032,["onClose"]))]),_:1},8,["modelValue"])])])])])}}};var Pe=le(je,[["__scopeId","data-v-5fc7c624"]]);export{Pe as default};
