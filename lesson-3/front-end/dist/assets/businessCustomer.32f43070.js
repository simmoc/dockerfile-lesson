
/**
 * 由 Fantastic-admin 提供技术支持
 * https://hooray.gitee.io/fantastic-admin/
 * Powered by Fantastic-admin
 * https://hooray.github.io/fantastic-admin/
 */
    
import{_ as K}from"./index.35de4a3a.js";import{_ as $}from"./index.a5dee889.js";import{_ as z}from"./index.333b158c.js";import{_ as O}from"./index.6ba23372.js";import{_ as G}from"./index.f1e12eef.js";import{P,O as J,M as D,Q as W,I as X,a7 as Z,r as m,a as d,q as u,t as _,y as n,L as l,z as i,B as ee,R as y,S as v,c as x,D as te,A as ae,H as C,F as le,G as oe}from"./vendor.d2559d84.js";import{H as re,d as ne}from"./index.94e839d6.js";import ie from"./CustomFilter.e17ad829.js";import{_ as se}from"./plugin-vue_export-helper.21dcd24c.js";import"./error.32433a76.js";const de=p=>(le("data-v-20db5222"),p=p(),oe(),p),me={class:"search-form"},ue={class:"search-form-margin"},ce=C("\u91CD\u7F6E"),_e=C("\u67E5\u8BE2"),pe={key:0},fe={class:"member-tag-pop p16"},ge={class:"inline-flex"},be=de(()=>_("span",{class:"color-primary"},"...",-1)),he={key:2},De=C(" \u67E5\u770B\u8BE6\u60C5 "),ye={setup(p){var F;const T=P(),V=J();let k=D(null),j=D(null),g=D(null);const e=W({formData:{subject_id:"",search_type:"1",page:1,limit:10,addDate:[],where_dynamic:[]},treeData:[{id:"\u603B\u90E8\u6807\u7B7E",name:"\u603B\u90E8\u6807\u7B7E",childrens:[{id:"\u6D88\u8D39\u6C34\u5E73",name:"\u6D88\u8D39\u6C34\u5E73",childrens:[{id:"5\u4E07\u5143/\u6708",name:"5\u4E07\u5143/\u6708",num:4}]}]},{id:"\u670D\u52A1\u6807\u7B7E",name:"\u670D\u52A1\u6807\u7B7E",childrens:[{id:"\u60C5\u611F\u9700\u6C42",name:"\u60C5\u611F\u9700\u6C42",childrens:[{id:"\u7F3A\u81EA\u4FE1",name:"\u7F3A\u81EA\u4FE1",num:4}]}]}],selectList:[],treeChecked:[],tableData:[],totalDataNum:0,isTableLoading:!1,tableTitle:[],customerNum:0});e.formData.subject_id=(F=V.meta)==null?void 0:F.subject_id,e.formData.tag_id=X(()=>e.treeChecked.map(o=>o.tag_id).join(","));const L=o=>{const t=24*60*60*1e3,r=Date.now(),c=r-t*90;return o.getTime()>r||o.getTime()<c};function w(){e.formData.page=1,e.formData.limit=10,f()}function f(){e.isTableLoading=!0;const o=Object.assign({},e.formData);[o.start_time,o.end_time]=o.addDate,delete o.addDate,re.extensiveCustomerSubjectList(o).then(t=>{t.data.list&&t.data.list.forEach(r=>{r.tag_arr=[...r.tag.hq,...r.tag.service]}),e.tableData=t.data.list||[],e.totalDataNum=t.data.total||0,e.customerNum=t.data.people_num||0,e.tableTitle=t.data.field.map(r=>({label:r.label,prop:r.name,fixed:r.name=="businessID"?"left":null,width:r.name=="businessID"?160:120,type:"tooltip"})),e.tableTitle.push({label:"\u6807\u7B7E",prop:"tag_arr",width:"230",type:"slot",fixed:"right"})}).catch(()=>{}).finally(()=>{e.isTableLoading=!1})}function R(){j.value.resetFields(),k.value.resetFields(),ne(e.treeChecked).forEach((t,r)=>{g.value.closeTag(r,t)}),e.treeChecked=[],e.selectList=[],e.formData.where_dynamic=[],e.formData.page=1,e.formData.limit=10,f()}const S=()=>{g.value.close()};function N(o,t){let r=e.formData.subject_id;T.push({name:"weChatCustomerDetail",query:{id:o,yw_id:t,subject_id:r}})}function I(o=[]){e.formData.start_time=o[0],e.formData.end_time=o[1]}return Z(async()=>{f()}),(o,t)=>{const r=m("el-input"),c=m("el-form-item"),B=m("el-date-picker"),H=K,b=m("el-button"),U=m("el-form"),h=$,M=m("el-popover"),Q=m("el-table-column"),Y=z,q=O,A=G;return d(),u("div",null,[_("div",me,[_("div",ue,[n(U,{ref_key:"ruleFormRef",ref:k,inline:"",size:"small","label-position":"right","label-width":"75px",model:l(e).formData,class:"clearfix"},{default:i(()=>[n(c,{label:"\u4E1A\u52A1ID\uFF1A ",prop:"yw_id"},{default:i(()=>[n(r,{modelValue:l(e).formData.yw_id,"onUpdate:modelValue":t[0]||(t[0]=a=>l(e).formData.yw_id=a),placeholder:"\u8BF7\u8F93\u5165",style:{width:"274px"},onKeyup:ee(w,["enter"])},null,8,["modelValue","onKeyup"])]),_:1}),n(c,{label:"\u6DFB\u52A0\u65F6\u95F4\uFF1A ",prop:"addDate"},{default:i(()=>[n(B,{modelValue:l(e).formData.addDate,"onUpdate:modelValue":t[1]||(t[1]=a=>l(e).formData.addDate=a),type:"daterange","range-separator":"\u81F3","start-placeholder":"\u5F00\u59CB\u65F6\u95F4","end-placeholder":"\u7ED3\u675F\u65F6\u95F4","value-format":"YYYY-MM-DD","disabled-date":L,onChange:I},null,8,["modelValue"])]),_:1}),n(c,{label:"\u6807\u7B7E\uFF1A "},{default:i(()=>[n(H,{ref_key:"customerSelectRef",ref:g,modelValue:l(e).treeChecked,"onUpdate:modelValue":t[2]||(t[2]=a=>l(e).treeChecked=a),"tree-data":l(e).treeData,"edit-select-list":l(e).selectList},null,8,["modelValue","tree-data","edit-select-list"])]),_:1}),n(ie,{ref_key:"customFilterRef",ref:j,modelValue:l(e).formData.where_dynamic,"onUpdate:modelValue":t[3]||(t[3]=a=>l(e).formData.where_dynamic=a),"subject-id":l(e).formData.subject_id,"close-customer-select":S},null,8,["modelValue","subject-id"]),n(c,{class:"right mr0"},{default:i(()=>[n(b,{disabled:l(e).isTableLoading,onClick:R},{default:i(()=>[ce]),_:1},8,["disabled"]),n(b,{type:"primary",disabled:l(e).isTableLoading,onClick:w},{default:i(()=>[_e]),_:1},8,["disabled"])]),_:1})]),_:1},8,["model"])])]),n(A,null,{default:i(()=>[n(Y,{loading:l(e).isTableLoading,"table-title":l(e).tableTitle,"table-data":l(e).tableData},{tag_arr:i(a=>[a.data.tag_arr.length<=1?(d(),u("div",pe,[(d(!0),u(y,null,v(a.data.tag_arr,s=>(d(),x(h,{key:s.id,"left-title":s.group_name,"right-title":s.name,color:s.tag_type==="HQ"?"#409eff":"#FF6F00","customer-style":{"margin-bottom":0}},null,8,["left-title","right-title","color"]))),128))])):(d(),x(M,{key:1,placement:"bottom",trigger:"click","popper-class":"key-word-pop",width:"542"},{reference:i(()=>[_("div",ge,[n(h,{"left-title":a.data.tag_arr[0].group_name,"right-title":a.data.tag_arr[0].name,"right-title-width":52,color:a.data.tag_arr[0].tag_type==="HQ"?"#409eff":"#FF6F00","customer-style":{"margin-bottom":0}},null,8,["left-title","right-title","color"]),be])]),default:i(()=>[_("div",fe,[(d(!0),u(y,null,v(a.data.tag_arr,s=>(d(),x(h,{key:s.id,"left-title":s.group_name,"right-title":s.name,color:s.tag_type==="HQ"?"#409eff":"#FF6F00","right-text-break":!1,"right-text-auto":!0},null,8,["left-title","right-title","color"]))),128))])]),_:2},1024)),a.data.tag_arr[0]?te("",!0):(d(),u("div",he,"--"))]),label:i(a=>[(d(!0),u(y,null,v(a.data.label,(s,E)=>(d(),u("div",{key:E,class:"company-tag"},ae(s),1))),128))]),default:i(()=>[n(Q,{label:"\u64CD\u4F5C",width:"100px",fixed:"right"},{default:i(({row:a})=>[_("div",null,[n(b,{type:"text",onClick:s=>N(a.id,a.yw_id)},{default:i(()=>[De]),_:2},1032,["onClick"])])]),_:1})]),_:1},8,["loading","table-title","table-data"]),n(q,{page:l(e).formData.page,"onUpdate:page":t[4]||(t[4]=a=>l(e).formData.page=a),limit:l(e).formData.limit,"onUpdate:limit":t[5]||(t[5]=a=>l(e).formData.limit=a),total:l(e).totalDataNum,"get-data":f},null,8,["page","limit","total"])]),_:1})])}}};var Re=se(ye,[["__scopeId","data-v-20db5222"]]);export{Re as default};
