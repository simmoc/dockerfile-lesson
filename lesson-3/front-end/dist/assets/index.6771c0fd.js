
/**
 * 由 Fantastic-admin 提供技术支持
 * https://hooray.gitee.io/fantastic-admin/
 * Powered by Fantastic-admin
 * https://hooray.github.io/fantastic-admin/
 */
    
import{_ as me}from"./index.333b158c.js";import{_ as he}from"./index.f1e12eef.js";import{_ as fe}from"./index.5931791c.js";import{P as ye,O as be,M as n,o as we,r as C,a as f,q as O,t as a,y as o,z as l,B as xe,R as ke,S as Ce,c as S,L as Ve,A as b,v as P,x as R,D as Y,J as Z,H as v,E as g}from"./vendor.d2559d84.js";import{a as Ge}from"./drag.56588ea6.js";import{H as w,b as Se}from"./index.94e839d6.js";import De from"./index.541cdffc.js";import{S as ze}from"./sortable.esm.81321d43.js";import"./plugin-vue_export-helper.21dcd24c.js";import"./vuedraggable.umd.56963d08.js";const Te={class:"mt16"},$e={class:"page-scroll"},je={class:"search-form mt0 pb0 mb0"},Le=v("\u91CD\u7F6E"),Ne=v("\u67E5\u8BE2"),Ke={class:"flex"},Ue={class:"table-search-box"},Ee={class:"flex mb8"},He=v("\u6DFB\u52A0\u5206\u7C7B"),Me={class:"tr fs12 c8c"},qe={class:"table-tree mt8"},Be={class:"flex-1"},Je={class:"table-top-area flex flex-align-center flex-justify-between"},Oe={class:"fs16 c0 mr8 fwb vtm"},Pe={class:"fs12 c9 vtm"},Re={class:"tr"},Ae=v(" \u6DFB\u52A0\u5546\u54C1 "),Fe=["data-sort"],Ie={class:"flex flex-align-center"},Qe=["src"],We={class:"goods-title ml8 lh24 show-line2"},Xe={key:0},Ye={class:"popover-content-box"},Ze={class:"popover-content"},es=["innerHTML"],ss=v(" \u4E0B\u67B6 "),ts=v(" \u4E0A\u67B6 "),os=v(" \u79FB\u52A8\u5230\u9876\u7AEF "),as=v(" \u7F16\u8F91 "),ls=v(" \u5220\u9664 "),ds={class:"table-blank"},is={class:"tc"},ns=a("div",null,"\u8BF7\u6DFB\u52A0\u5206\u7C7B\u540E\u6DFB\u52A0\u5546\u54C1",-1),_s=v("\u6DFB\u52A0\u5206\u7C7B"),rs=a("div",{class:"mb8"},"\u5206\u7C7B\u540D\u79F0",-1),cs={class:""},us=a("div",{class:"mb8"},"\u5E93\u5B58:",-1),ps=a("span",null,"\u4EF6",-1),gs={class:"group_name"},Gs={setup(vs){const ee=ye(),U=be(),d=n({goods_class_id:"",search_goods_name:"",search_goods_category_id:"",search_goods_status:"",search_goods_stock_status:""}),y=n([]),m=n({goods_id:"",type:"",goods_stock:0}),$=n(!1),E=n({goods_id:""}),H=n({goods_class_id:"",goods_list:[]}),A=n([]),D=n(null),c=n({search_class_name:"",search_goods_name:"",search_goods_category_id:"",search_goods_status:"",search_goods_stock_status:""}),_=n([]),z=n(!1),j=n({}),V=n(""),M=n(!1),q=n(!1),x=n({title:"\u63D0\u793A",content:"",type:"",fn:()=>{}}),L=n([{label:"\u6392\u5E8F",prop:"sort",type:"slot",width:50},{label:"\u5546\u54C1\u540D\u79F0",prop:"goods_title",width:240,type:"slot"},{label:"\u5151\u6362\u6240\u9700\u79EF\u5206",prop:"goods_score",width:120},{label:"\u5546\u54C1\u7C7B\u76EE",prop:"category_name",width:120},{label:"\u5E93\u5B58",prop:"goods_stock",width:100},{label:"\u5546\u54C1\u72B6\u6001",prop:"sale_status",type:"slot",width:100},{label:"\u6838\u9500\u65F6\u95F4",prop:"date",type:"slot"},{label:"\u64CD\u4F5C",prop:"operation",fixed:"right",type:"slot",width:230}]),se=s=>{new RegExp("^[0-9]([0-9])*$").test(s.target.value)||(s.target.value=s.target.value.replace(/[^[0-9]]*/g,""))},k=async s=>{let{data:e,code:i}=await w.getGoodsCates(c.value);if(i==200)if(_.value=e||[],s)s();else{if(U.query&&U.query.goods_class_id){let r={};_.value.forEach((u,h)=>{u.goods_class_id==U.query.goods_class_id&&(r=h)}),D.value.handlerGroupKnowledge(_.value[r]);return}D.value.handlerGroupKnowledge(_.value[0])}},te=async()=>{let{data:s,code:e}=await w.getGoodsTypes();e==200&&(A.value=s||[])},G=async s=>{if(s&&(d.value.goods_class_id=s,y.value=[]),!d.value.goods_class_id)return;let{data:e,code:i}=await w.getGoodsList(d.value);i==200&&(y.value=e||[])},oe=Se(()=>{j.value={},k()}),ae=s=>{d.value.search_class_name="",c.value.search_group_name="",k(()=>{D.value.handlerGroupKnowledge(_.value[s])})},le=async()=>{H.value.goods_class_id=d.value.goods_class_id;let{code:s,msg:e}=await w.updateGoodsSort(H.value);if(s==200){g.success({message:"\u64CD\u4F5C\u6210\u529F"}),y.value=[],G();return}g.warning({message:e})},N=s=>{const e=document.querySelectorAll(".el-table__body-wrapper > table > tbody")[0];ze.create(e,{disabled:s,ghostClass:"sortable-ghost",handle:".can-drag-icon",setData:function(i){i.setData("Text","")},onEnd:({newIndex:i,oldIndex:r})=>{let u=[],h=JSON.parse(JSON.stringify(y.value));h=de(h,i,r),h.forEach((p,B)=>{u.push({goods_id:p.goods_id,sort:200-B})}),H.value.goods_list=u,le()}})};function de(s,e,i){let r=JSON.parse(JSON.stringify(s[i]));return s.splice(i,1),s.splice(e,0,r),s}const F=()=>{if(console.log("\u5206\u7C7B\u957F\u5EA6",_.value.length),_.value.length>=20){g.warning("\u5F53\u524D\u5206\u7C7B\u5DF2\u670920\u4E2A\uFF0C\u4E0D\u53EF\u6DFB\u52A0");return}M.value=!0},T=()=>{V.value="",M.value=!1,q.value=!1},ie=async()=>{if(!V.value){g.error("\u5206\u7C7B\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A");return}(await w.adddGoodsCate({name:V.value})).code===200&&(g.success("\u6DFB\u52A0\u6210\u529F!"),T(),V.value="",d.value.search_goods_name="",c.value.search_class_name="",k(()=>{D.value.handlerGroupKnowledge(_.value[_.value.length-1])}))},ne=s=>s.goods_type=="logistics"?"-":s.validity_time_type=="relative_time"?`\u786E\u8BA4\u5151\u6362\u540E${s.relative_days}\u5929\u5185\u53EF\u7528`:`${s.validity_start_time} \u81F3<br /> ${s.validity_end_time}`,_e=s=>{console.log(s),m.value.goods_id=s.goods_id||"",m.value.goods_stock=s.goods_stock||0,m.value.type="on_sale",$.value=!0},I=async()=>{let{code:s,msg:e}=await w.updataGoodsStatus(m.value);if(s==200){T(),$.value=!1,g.success({message:"\u64CD\u4F5C\u6210\u529F"}),G();return}g.warning({message:e})},Q=(s,e,i)=>{s=="delete"&&e.sale_status=="on_sale"?(E.value.goods_id=e.goods_id,x.value.content="\u8BE5\u5546\u54C1\u5904\u4E8E\u4E0A\u67B6\u72B6\u6001\uFF0C\u662F\u5426\u5220\u9664\u8BE5\u5546\u54C1"):s=="delete"&&e.sale_status!=="on_sale"?(E.value.goods_id=e.goods_id,x.value.content="\u662F\u5426\u5220\u9664\u8BE5\u5546\u54C1"):s=="off_sale"&&(x.value.content="\u662F\u5426\u786E\u8BA4\u4E0B\u67B6\u5546\u54C1",m.value.type="off_sale",m.value.goods_stock=e.goods_stock,m.value.goods_id=e.goods_id),x.value.fn=i,q.value=!0},re=async(s,e)=>{let{code:i,msg:r}=await w.topGoodsSort({goods_id:s,goods_class_id:e});if(i==200){g.success({message:"\u64CD\u4F5C\u6210\u529F"}),G();return}g.error({message:r})},ce=async()=>{let{code:s,msg:e}=await w.deleteGoods(E.value);if(s==200){g.success({message:"\u64CD\u4F5C\u6210\u529F"}),G(),T();return}g.error({message:e})},ue=()=>{d.value.search_goods_name="",d.value.search_goods_category_id="",d.value.search_goods_status="",d.value.search_goods_stock_status="",c.value.search_goods_name="",c.value.search_goods_category_id="",c.value.search_goods_status="",c.value.search_goods_stock_status="",z.value=!1,L.value=[{label:"\u6392\u5E8F",prop:"sort",type:"slot",width:50},{label:"\u5546\u54C1\u540D\u79F0",prop:"goods_title",width:240,type:"slot"},{label:"\u5151\u6362\u6240\u9700\u79EF\u5206",prop:"goods_score",width:120},{label:"\u5546\u54C1\u7C7B\u76EE",prop:"category_name",width:120},{label:"\u5E93\u5B58",prop:"goods_stock",width:100},{label:"\u5546\u54C1\u72B6\u6001",prop:"sale_status",type:"slot",width:100},{label:"\u6838\u9500\u65F6\u95F4",prop:"date",type:"slot"},{label:"\u64CD\u4F5C",prop:"operation",fixed:"right",type:"slot",width:230}],N(!1),k()},W=()=>{c.value.search_goods_name=d.value.search_goods_name,c.value.search_goods_category_id=d.value.search_goods_category_id,c.value.search_goods_status=d.value.search_goods_status,c.value.search_goods_stock_status=d.value.search_goods_stock_status,d.value.search_goods_name||d.value.search_goods_status||d.value.search_goods_stock_status||d.value.search_goods_category_id?(z.value=!0,N(!0),L.value=[{label:"\u6392\u5E8F",prop:"sort",type:"slot",width:50},{label:"\u5546\u54C1\u540D\u79F0",prop:"goods_title",width:240,type:"slot"},{label:"\u5151\u6362\u6240\u9700\u79EF\u5206",prop:"goods_score",width:120},{label:"\u5546\u54C1\u7C7B\u76EE",prop:"category_name",width:120},{label:"\u5E93\u5B58",prop:"goods_stock",width:100},{label:"\u5546\u54C1\u72B6\u6001",prop:"sale_status",type:"slot",width:100},{label:"\u6838\u9500\u65F6\u95F4",prop:"date",type:"slot"},{label:"\u64CD\u4F5C",prop:"operation",fixed:"right",type:"slot",width:230}]):(z.value=!1,N(!1),L.value=[{label:"\u6392\u5E8F",prop:"sort",type:"slot",width:50},{label:"\u5546\u54C1\u540D\u79F0",prop:"goods_title",width:240,type:"slot"},{label:"\u5151\u6362\u6240\u9700\u79EF\u5206",prop:"goods_score",width:120},{label:"\u5546\u54C1\u7C7B\u76EE",prop:"category_name",width:120},{label:"\u5E93\u5B58",prop:"goods_stock",width:100},{label:"\u5546\u54C1\u72B6\u6001",prop:"sale_status",type:"slot",width:100},{label:"\u6838\u9500\u65F6\u95F4",prop:"date",type:"slot"},{label:"\u64CD\u4F5C",prop:"operation",fixed:"right",type:"slot",width:230}]),G(),k()},X=(s,e)=>{ee.push({name:s,query:e})};return we(()=>{te(),k(),N(!1)}),(s,e)=>{const i=C("el-input"),r=C("el-form-item"),u=C("el-option"),h=C("el-select"),p=C("el-button"),B=C("el-form"),pe=C("el-popover"),ge=me,ve=he,J=fe;return f(),O("div",Te,[a("div",$e,[a("div",je,[o(B,{inline:!0,model:d.value,"label-position":"right","label-width":"120px",size:"small",class:"clearfix"},{default:l(()=>[o(r,{label:"\u5546\u54C1\u540D\u79F0\uFF1A"},{default:l(()=>[o(i,{modelValue:d.value.search_goods_name,"onUpdate:modelValue":e[0]||(e[0]=t=>d.value.search_goods_name=t),placeholder:"\u8BF7\u8F93\u5165\u6587\u672C\u5185\u5BB9",style:{width:"274px"},onKeyup:xe(W,["enter"])},null,8,["modelValue","onKeyup"])]),_:1}),o(r,{label:"\u5546\u54C1\u7C7B\u76EE\uFF1A"},{default:l(()=>[o(h,{modelValue:d.value.search_goods_category_id,"onUpdate:modelValue":e[1]||(e[1]=t=>d.value.search_goods_category_id=t),placeholder:"\u8BF7\u9009\u62E9",style:{width:"274px"}},{default:l(()=>[o(u,{label:"\u5168\u90E8",value:""}),(f(!0),O(ke,null,Ce(A.value,t=>(f(),S(u,{key:t.goods_category_id,label:t.name,value:t.goods_category_id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(r,{label:"\u6709\u65E0\u5E93\u5B58\uFF1A"},{default:l(()=>[o(h,{modelValue:d.value.search_goods_stock_status,"onUpdate:modelValue":e[2]||(e[2]=t=>d.value.search_goods_stock_status=t),placeholder:"\u8BF7\u9009\u62E9",style:{width:"274px"}},{default:l(()=>[o(u,{label:"\u5168\u90E8",value:""}),o(u,{label:"\u6709",value:"sale"}),o(u,{label:"\u552E\u7F44",value:"sold_out"})]),_:1},8,["modelValue"])]),_:1}),o(r,{label:"\u5546\u54C1\u72B6\u6001\uFF1A"},{default:l(()=>[o(h,{modelValue:d.value.search_goods_status,"onUpdate:modelValue":e[3]||(e[3]=t=>d.value.search_goods_status=t),placeholder:"\u8BF7\u9009\u62E9",style:{width:"274px"}},{default:l(()=>[o(u,{label:"\u5168\u90E8",value:""}),o(u,{label:"\u4E0A\u67B6",value:"on_sale"}),o(u,{label:"\u4E0B\u67B6",value:"off_sale"})]),_:1},8,["modelValue"])]),_:1}),o(r,{class:"right mr0"},{default:l(()=>[o(p,{type:"default",size:"small",onClick:ue},{default:l(()=>[Le]),_:1}),o(p,{type:"primary",size:"small",onClick:W},{default:l(()=>[Ne]),_:1})]),_:1})]),_:1},8,["model"])]),o(ve,{class:"mt16 mt0"},{default:l(()=>[a("div",Ke,[a("div",Ue,[a("div",Ee,[o(i,{modelValue:c.value.search_class_name,"onUpdate:modelValue":e[4]||(e[4]=t=>c.value.search_class_name=t),"prefix-icon":"el-icon-search",placeholder:"\u8BF7\u8F93\u5165\u5206\u7C7B\u540D\u79F0",size:"small",class:"table-search-input",onInput:e[5]||(e[5]=t=>Ve(oe)(t))},null,8,["modelValue"]),o(p,{size:"small",onClick:F},{default:l(()=>[He]),_:1})]),a("div",Me," \u5206\u7C7B "+b(_.value.length)+" / 20 ",1),a("div",qe,[o(De,{ref_key:"treeDrag",ref:D,modelValue:j.value,"onUpdate:modelValue":e[6]||(e[6]=t=>j.value=t),"group-list":_.value,"is-search":z.value,"get-list":G,"get-group-list":k,"set-tree-checked":ae},null,8,["modelValue","group-list","is-search"])])]),a("div",Be,[a("div",Je,[P(a("div",null,[a("span",Oe,b(j.value.name),1),a("span",Pe,"\u6B64\u5206\u7C7B\u5185\u5DF2\u6709\u5546\u54C1 "+b(y.value.length)+"/100",1)],512),[[R,_.value.length>0]]),a("div",Re,[_.value.length>0?(f(),S(p,{key:0,icon:"el-icon-plus",type:"primary",size:"small","data-isSet":"1",disabled:y.value.length>99,onClick:e[7]||(e[7]=t=>X("addGoods",{goods_class_id:d.value.goods_class_id,category_id:d.value.search_goods_category_id,pageType:"add"}))},{default:l(()=>[Ae]),_:1},8,["disabled"])):Y("",!0)])]),P(o(ge,{"table-title":L.value,"table-data":y.value,"need-pagination":!0,class:Z(["customer-tree",{"is-collapse":s.$store.state.settings.mode==="pc"&&s.$store.state.settings.sidebarCollapse}])},{sort:l(t=>[a("div",{class:Z(["flex flex-align-center flex-space-center",[z.value?"":"can-drag-icon"]]),style:{height:"50px"}},[a("img",{style:{width:"12px",height:"12px","margin-left":"8px","vertical-align":"middle"},src:Ge,"data-sort":t.data.sort,alt:""},null,8,Fe)],2)]),goods_title:l(t=>[a("div",Ie,[a("img",{class:"goods-img flex-g0 flex-s0",src:t.data.goods_thumb_img,alt:"\u5546\u54C1\u56FE\u7247"},null,8,Qe),a("div",We,[t.data.goods_title.length<=24?(f(),O("div",Xe,b(t.data.goods_title),1)):(f(),S(pe,{key:1,placement:"bottom",width:"400",trigger:"hover","popper-class":"member-info-pop"},{reference:l(()=>[a("div",Ze,b(t.data.goods_title.substring(0,24))+" ... ",1)]),default:l(()=>[a("div",Ye,b(t.data.goods_title),1)]),_:2},1024))])])]),sale_status:l(t=>[a("div",null,b(t.data.sale_status=="on_sale"?"\u5DF2\u4E0A\u67B6":"\u5DF2\u4E0B\u67B6"),1)]),date:l(t=>[a("div",{innerHTML:ne(t.data)},null,8,es)]),operation:l(t=>[a("div",null,[t.data.sale_status=="on_sale"?(f(),S(p,{key:0,type:"text",size:"mini",onClick:K=>Q("off_sale",t.data,I)},{default:l(()=>[ss]),_:2},1032,["onClick"])):(f(),S(p,{key:1,type:"text",size:"mini",onClick:K=>_e(t.data)},{default:l(()=>[ts]),_:2},1032,["onClick"])),t.data.goods_id!==y.value[0].goods_id?(f(),S(p,{key:2,type:"text",size:"mini",onClick:K=>re(t.data.goods_id,d.value.goods_class_id)},{default:l(()=>[os]),_:2},1032,["onClick"])):Y("",!0),o(p,{type:"text",size:"mini",onClick:K=>X("editGoods",{goods_id:t.data.goods_id,pageType:"edit"})},{default:l(()=>[as]),_:2},1032,["onClick"]),o(p,{type:"text",size:"mini",onClick:K=>Q("delete",t.data,ce)},{default:l(()=>[ls]),_:2},1032,["onClick"])])]),_:1},8,["table-title","table-data","class"]),[[R,_.value.length>0]]),P(a("div",ds,[a("div",is,[ns,o(p,{size:"small",type:"primary",class:"mt16",onClick:F},{default:l(()=>[_s]),_:1})])],512),[[R,_.value.length===0]])])])]),_:1}),o(J,{title:"\u6DFB\u52A0\u5206\u7C7B\u540D\u79F0","dialog-visible":M.value,width:"418px","confirm-fn":ie,onCancel:T},{default:l(()=>[rs,o(i,{modelValue:V.value,"onUpdate:modelValue":e[8]||(e[8]=t=>V.value=t),autocomplete:"off",maxlength:"5",placeholder:"\u8BF7\u8F93\u5165\u5206\u7C7B\u540D\u79F0","show-word-limit":""},null,8,["modelValue"])]),_:1},8,["dialog-visible"]),o(J,{title:"\u4E0A\u67B6\u5546\u54C1","dialog-visible":$.value,width:"418px","confirm-fn":I,onCancel:e[10]||(e[10]=t=>$.value=!1)},{default:l(()=>[a("div",cs,[us,o(i,{modelValue:m.value.goods_stock,"onUpdate:modelValue":e[9]||(e[9]=t=>m.value.goods_stock=t),modelModifiers:{number:!0},type:"number",autocomplete:"off",placeholder:"\u8BF7\u8F93\u5165\u5206\u7C7B\u540D\u79F0",size:"small",onKeyup:se},{append:l(()=>[ps]),_:1},8,["modelValue"])])]),_:1},8,["dialog-visible"]),o(J,{title:x.value.title,"dialog-visible":q.value,width:"400px","confirm-fn":x.value.fn,onCancel:T},{default:l(()=>[a("div",gs,b(x.value.content),1)]),_:1},8,["title","dialog-visible","confirm-fn"])])])}}};export{Gs as default};
